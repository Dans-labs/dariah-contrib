<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.2" />
<title>test_50_review20 API documentation</title>
<meta name="description" content="Test scenario for reviews â€¦" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>test_50_review20</code></h1>
</header>
<section id="section-intro">
<p>Test scenario for reviews.</p>
<h2 id="domain">Domain</h2>
<ul>
<li>Users as in <a title="conftest" href="conftest.html"><code>conftest</code></a>, under <em>players</em></li>
<li>Clean slate, see <a title="starters" href="starters.html"><code>starters</code></a>.</li>
<li>The user table</li>
<li>The country table</li>
<li>One contribution record</li>
<li>One assessment record</li>
<li>The assessment submitted and reviewers assigned.</li>
<li>Two reviews, with review comments filled out.</li>
</ul>
<h2 id="acts">Acts</h2>
<p>Filling out reviews.</p>
<dl>
<dt><code>test_reviewEntryViewAll</code></dt>
<dd>All users try to see the review entries, but only
<strong>expert</strong> and <strong>final</strong> succeed for their own comments, and the power users
succeed for all comments.
Only when a review decision has been taken, the review comments become readable
to the owner/editor of the contribution, the other reviewer, and the national
coordinator.</dd>
<dt><a title="test_50_review20.test_decideOthers" href="#test_50_review20.test_decideOthers"><code>test_decideOthers()</code></a></dt>
<dd>All users except the reviewers try to make all review decisions.
None of them succeeds.</dd>
<dt><a title="test_50_review20.test_reviewersDecide" href="#test_50_review20.test_reviewersDecide"><code>test_reviewersDecide()</code></a></dt>
<dd><strong>expert</strong> tries to make all possible decisions and then revokes
his last decision.
After that, <strong>final</strong> tries the same, but fails, because
<strong>final</strong> can only decide after <strong>expert</strong>.</dd>
<dt><a title="test_50_review20.test_expertDecides" href="#test_50_review20.test_expertDecides"><code>test_expertDecides()</code></a></dt>
<dd><strong>expert</strong> tries to revoke the decision, but fails because the decision
is already revoked.
Then he Accepts.
Then he Accepts again, but fails, because it is the same as the existing
decision.</dd>
<dt><a title="test_50_review20.test_finalAccepts" href="#test_50_review20.test_finalAccepts"><code>test_finalAccepts()</code></a></dt>
<dd><strong>final</strong> accepts.
After that <strong>expert</strong> tries to take all review decisions, but fails,
because the final decision has been taken.</dd>
<dt><a title="test_50_review20.test_modify" href="#test_50_review20.test_modify"><code>test_modify()</code></a></dt>
<dd>All users try to modify a field in the contribution, in the assessment, and in
a review comment, but all fail, because everything is in a finished state.
In particular, also a re-assignment of the reviewers to the assessment it attempted.</dd>
<dt><a title="test_50_review20.test_finalRevokes" href="#test_50_review20.test_finalRevokes"><code>test_finalRevokes()</code></a></dt>
<dd><strong>final</strong> revokes his decision.
After that <strong>expert</strong> tries to take all review decisions, and succeeds,
because there is no final decision.</dd>
<dt><a title="test_50_review20.test_modify2" href="#test_50_review20.test_modify2"><code>test_modify2()</code></a></dt>
<dd>
<p>All users try to modify a field in the contribution, in the assessment, and in
a review comment, and some succeed, because there is no finished state.</p>
<p>The assesssment is still submitted, so the contribution and assessment are still
locked: nobody can modify them.</p>
<p>The reviewers can be reassigned by <strong>office</strong>.</p>
<p>The reviews can be modified.</p>
</dd>
</dl>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Test scenario for reviews.

## Domain

*   Users as in `conftest`, under *players*
*   Clean slate, see `starters`.
*   The user table
*   The country table
*   One contribution record
*   One assessment record
*   The assessment submitted and reviewers assigned.
*   Two reviews, with review comments filled out.

## Acts

Filling out reviews.

`test_reviewEntryViewAll`
:   All users try to see the review entries, but only
    **expert** and **final** succeed for their own comments, and the power users
    succeed for all comments.
    Only when a review decision has been taken, the review comments become readable
    to the owner/editor of the contribution, the other reviewer, and the national
    coordinator.

`test_decideOthers`
:   All users except the reviewers try to make all review decisions.
    None of them succeeds.

`test_reviewersDecide`
:   **expert** tries to make all possible decisions and then revokes
    his last decision.
    After that, **final** tries the same, but fails, because
    **final** can only decide after **expert**.

`test_expertDecides`
:   **expert** tries to revoke the decision, but fails because the decision
    is already revoked.
    Then he Accepts.
    Then he Accepts again, but fails, because it is the same as the existing
    decision.

`test_finalAccepts`
:   **final** accepts.
    After that **expert** tries to take all review decisions, but fails,
    because the final decision has been taken.

`test_modify`
:   All users try to modify a field in the contribution, in the assessment, and in
    a review comment, but all fail, because everything is in a finished state.
    In particular, also a re-assignment of the reviewers to the assessment it attempted.

`test_finalRevokes`
:   **final** revokes his decision.
    After that **expert** tries to take all review decisions, and succeeds,
    because there is no final decision.

`test_modify2`
:   All users try to modify a field in the contribution, in the assessment, and in
    a review comment, and some succeed, because there is no finished state.

    The assesssment is still submitted, so the contribution and assessment are still
    locked: nobody can modify them.

    The reviewers can be reassigned by **office**.

    The reviews can be modified.
&#34;&#34;&#34;

import pytest

import magic  # noqa
from control.utils import pick as G
from conftest import USERS, POWER_USERS
from example import (
    ACCEPT,
    ASSESS,
    COMMENTS,
    COMMENTS_E,
    COMMENTS_F,
    CONTRIB,
    CRITERIA_ENTRY,
    EVIDENCE,
    EVIDENCE1,
    EXPERT,
    FINAL,
    OFFICE,
    REJECT,
    REMARKS,
    REMARKS_E,
    REMARKS_F,
    REVIEW,
    REVIEW_DECISION,
    REVIEW_ENTRY,
    REVIEWER_E,
    REVISE,
    REVOKE,
    TITLE,
    TITLE2,
    TITLE_A2,
    USER,
)
from helpers import (
    findReviewEntries,
    forall,
    getItem,
    getReviewEntryId,
)
from starters import start
from subtest import (
    assertFieldValue,
    assertModifyField,
    assertReviewDecisions,
    assertStatus,
)

startInfo = {}


@pytest.mark.usefixtures(&#34;db&#34;)
def test_start(clientOffice, clientOwner, clientExpert, clientFinal):
    startInfo.update(start(
        clientOffice=clientOffice,
        clientOwner=clientOwner,
        clientExpert=clientExpert,
        clientFinal=clientFinal,
        users=True,
        assessment=True,
        countries=True,
        review=True,
    ))


def test_reviewEntryView(clients):
    recordId = startInfo[&#34;recordId&#34;]

    cIds = recordId[CRITERIA_ENTRY]
    cIdFirst = cIds[0]
    reId = {}
    for user in {EXPERT, FINAL}:
        criteriaEntryInfo = getItem(clients[user], CRITERIA_ENTRY, cIdFirst)
        text = criteriaEntryInfo[&#34;text&#34;]
        reviewEntries = findReviewEntries(text)
        reId[user] = reviewEntries[user][0]

    def assertIt(cl, exp):
        user = cl.user
        for (kind, rId) in reId.items():
            value = f&#34;{kind}&#39;s comment on criteria 1&#34;
            expValue = (
                None
                if exp is None
                else value
                if user in {EXPERT, FINAL} | POWER_USERS
                else None
            )
            assertFieldValue((cl, REVIEW_ENTRY, rId), COMMENTS, expValue)

    expect = {user: None for user in USERS}
    expect.update({user: True for user in {EXPERT, FINAL} | POWER_USERS})
    forall(clients, expect, assertIt)


def test_decideOthers(clients):
    recordId = startInfo[&#34;recordId&#34;]

    reviewId = G(recordId, REVIEW)

    def assertIt(cl, exp):
        user = cl.user
        for kind in [EXPERT, FINAL]:
            rId = G(reviewId, kind)
            expStatus = kind == user if exp else exp
            for decision in [REJECT, REVISE, ACCEPT, REVOKE]:
                decisionStr = G(G(REVIEW_DECISION, decision), kind)
                url = f&#34;/api/task/{decisionStr}/{rId}&#34;
                assertStatus(cl, url, expStatus)

    expect = {user: False for user in USERS if user not in {EXPERT, FINAL}}
    forall(clients, expect, assertIt)


def test_reviewersDecide(clientsReviewer):
    recordId = startInfo[&#34;recordId&#34;]
    reviewId = G(recordId, REVIEW)

    assertReviewDecisions(
        clientsReviewer,
        reviewId,
        [EXPERT, FINAL],
        [REJECT, REVISE, ACCEPT, REVOKE],
        {EXPERT: True, FINAL: False},
    )


def test_expertDecides(clientsReviewer):
    recordId = startInfo[&#34;recordId&#34;]
    reviewId = G(recordId, REVIEW)

    assertReviewDecisions(
        clientsReviewer, reviewId, [EXPERT], [REVOKE], False,
    )
    assertReviewDecisions(
        clientsReviewer, reviewId, [EXPERT], [ACCEPT], True,
    )
    assertReviewDecisions(
        clientsReviewer, reviewId, [EXPERT], [ACCEPT], False,
    )


def test_finalAccepts(clientsReviewer):
    recordId = startInfo[&#34;recordId&#34;]
    reviewId = G(recordId, REVIEW)

    assertReviewDecisions(
        clientsReviewer, reviewId, [FINAL], [ACCEPT], True,
    )
    assertReviewDecisions(
        clientsReviewer, reviewId, [EXPERT], [REJECT, REVISE, ACCEPT, REVOKE], False,
    )


def test_modify(clients):
    valueTables = startInfo[&#34;valueTables&#34;]
    recordId = startInfo[&#34;recordId&#34;]

    users = valueTables[USER]
    eid = recordId[CONTRIB]
    aId = recordId[ASSESS]
    reviewId = recordId[REVIEW]
    rExpertId = reviewId[EXPERT]
    rFinalId = reviewId[FINAL]
    cIdFirst = recordId[CRITERIA_ENTRY][0]
    renId = getReviewEntryId(clients, cIdFirst, rExpertId, rFinalId)

    def assertIt(cl, exp):
        assertModifyField(cl, CONTRIB, eid, TITLE, TITLE2, exp)
        assertModifyField(cl, ASSESS, aId, TITLE, TITLE_A2, exp)
        reviewerFId = G(users, FINAL)
        assertModifyField(cl, ASSESS, aId, REVIEWER_E, (reviewerFId, FINAL), exp)
        assertModifyField(
            cl, CRITERIA_ENTRY, cIdFirst, EVIDENCE, ([EVIDENCE1], EVIDENCE1), exp
        )
        for (rId, remarks) in ((rExpertId, REMARKS_E), (rFinalId, REMARKS_F)):
            assertModifyField(cl, REVIEW, rId, REMARKS, ([remarks], remarks), exp)
        for (u, reid) in renId.items():
            comments = COMMENTS_E if u == EXPERT else COMMENTS_F
            assertModifyField(
                cl, REVIEW_ENTRY, reid, COMMENTS, ([comments], comments), exp
            )

    expect = {user: False for user in USERS}
    forall(clients, expect, assertIt)


def test_finalRevokes(clientsReviewer):
    recordId = startInfo[&#34;recordId&#34;]
    reviewId = G(recordId, REVIEW)

    assertReviewDecisions(
        clientsReviewer, reviewId, [FINAL], [REVOKE], True,
    )
    assertReviewDecisions(
        clientsReviewer, reviewId, [EXPERT], [REJECT, REVISE, ACCEPT, REVOKE], True,
    )


def test_modify2(clients):
    valueTables = startInfo[&#34;valueTables&#34;]
    recordId = startInfo[&#34;recordId&#34;]

    users = valueTables[USER]
    eid = recordId[CONTRIB]
    aId = recordId[ASSESS]
    reviewId = recordId[REVIEW]
    rExpertId = reviewId[EXPERT]
    rFinalId = reviewId[FINAL]
    cIdFirst = recordId[CRITERIA_ENTRY][0]
    renId = getReviewEntryId(clients, cIdFirst, rExpertId, rFinalId)

    def assertIt(cl, exp):
        assertModifyField(cl, CONTRIB, eid, TITLE, TITLE2, exp[CONTRIB])
        assertModifyField(cl, ASSESS, aId, TITLE, TITLE_A2, exp[ASSESS])
        reviewerFId = G(users, FINAL)
        assertModifyField(
            cl, ASSESS, aId, REVIEWER_E, (reviewerFId, FINAL), exp[&#34;assign&#34;]
        )
        assertModifyField(
            cl,
            CRITERIA_ENTRY,
            cIdFirst,
            EVIDENCE,
            ([EVIDENCE1], EVIDENCE1),
            exp[CRITERIA_ENTRY],
        )
        for (rId, remarks, kind) in (
            (rExpertId, REMARKS_E, EXPERT),
            (rFinalId, REMARKS_F, FINAL),
        ):
            assertModifyField(
                cl, REVIEW, rId, REMARKS, ([remarks], remarks), exp[f&#34;{REVIEW}_{kind}&#34;]
            )
        for (kind, reid) in renId.items():
            comments = COMMENTS_E if kind == EXPERT else COMMENTS_F
            assertModifyField(
                cl,
                REVIEW_ENTRY,
                reid,
                COMMENTS,
                ([comments], comments),
                exp[f&#34;{REVIEW_ENTRY}_{kind}&#34;],
            )

    expectDefault = {user: False for user in USERS}
    expectPerKind = {
        CONTRIB: dict(expectDefault),
        ASSESS: dict(expectDefault),
        CRITERIA_ENTRY: dict(expectDefault),
        &#34;assign&#34;: dict(expectDefault),
        f&#34;{REVIEW}_{EXPERT}&#34;: dict(expectDefault),
        f&#34;{REVIEW}_{FINAL}&#34;: dict(expectDefault),
        f&#34;{REVIEW_ENTRY}_{EXPERT}&#34;: dict(expectDefault),
        f&#34;{REVIEW_ENTRY}_{FINAL}&#34;: dict(expectDefault),
    }
    expectPerKind[&#34;assign&#34;].update({user: True for user in {OFFICE}})
    expectPerKind[f&#34;{REVIEW}_{EXPERT}&#34;].update(
        {user: True for user in {EXPERT} | POWER_USERS}
    )
    expectPerKind[f&#34;{REVIEW}_{FINAL}&#34;].update(
        {user: True for user in {FINAL} | POWER_USERS}
    )
    expectPerKind[f&#34;{REVIEW_ENTRY}_{EXPERT}&#34;].update(
        {user: True for user in {EXPERT} | POWER_USERS}
    )
    expectPerKind[f&#34;{REVIEW_ENTRY}_{FINAL}&#34;].update(
        {user: True for user in {FINAL} | POWER_USERS}
    )
    expect = {}
    for (kind, expectKind) in expectPerKind.items():
        for (user, exp) in expectKind.items():
            expect.setdefault(user, {})[kind] = exp

    forall(clients, expect, assertIt)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="test_50_review20.test_decideOthers"><code class="name flex">
<span>def <span class="ident">test_decideOthers</span></span>(<span>clients)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_decideOthers(clients):
    recordId = startInfo[&#34;recordId&#34;]

    reviewId = G(recordId, REVIEW)

    def assertIt(cl, exp):
        user = cl.user
        for kind in [EXPERT, FINAL]:
            rId = G(reviewId, kind)
            expStatus = kind == user if exp else exp
            for decision in [REJECT, REVISE, ACCEPT, REVOKE]:
                decisionStr = G(G(REVIEW_DECISION, decision), kind)
                url = f&#34;/api/task/{decisionStr}/{rId}&#34;
                assertStatus(cl, url, expStatus)

    expect = {user: False for user in USERS if user not in {EXPERT, FINAL}}
    forall(clients, expect, assertIt)</code></pre>
</details>
</dd>
<dt id="test_50_review20.test_expertDecides"><code class="name flex">
<span>def <span class="ident">test_expertDecides</span></span>(<span>clientsReviewer)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_expertDecides(clientsReviewer):
    recordId = startInfo[&#34;recordId&#34;]
    reviewId = G(recordId, REVIEW)

    assertReviewDecisions(
        clientsReviewer, reviewId, [EXPERT], [REVOKE], False,
    )
    assertReviewDecisions(
        clientsReviewer, reviewId, [EXPERT], [ACCEPT], True,
    )
    assertReviewDecisions(
        clientsReviewer, reviewId, [EXPERT], [ACCEPT], False,
    )</code></pre>
</details>
</dd>
<dt id="test_50_review20.test_finalAccepts"><code class="name flex">
<span>def <span class="ident">test_finalAccepts</span></span>(<span>clientsReviewer)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_finalAccepts(clientsReviewer):
    recordId = startInfo[&#34;recordId&#34;]
    reviewId = G(recordId, REVIEW)

    assertReviewDecisions(
        clientsReviewer, reviewId, [FINAL], [ACCEPT], True,
    )
    assertReviewDecisions(
        clientsReviewer, reviewId, [EXPERT], [REJECT, REVISE, ACCEPT, REVOKE], False,
    )</code></pre>
</details>
</dd>
<dt id="test_50_review20.test_finalRevokes"><code class="name flex">
<span>def <span class="ident">test_finalRevokes</span></span>(<span>clientsReviewer)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_finalRevokes(clientsReviewer):
    recordId = startInfo[&#34;recordId&#34;]
    reviewId = G(recordId, REVIEW)

    assertReviewDecisions(
        clientsReviewer, reviewId, [FINAL], [REVOKE], True,
    )
    assertReviewDecisions(
        clientsReviewer, reviewId, [EXPERT], [REJECT, REVISE, ACCEPT, REVOKE], True,
    )</code></pre>
</details>
</dd>
<dt id="test_50_review20.test_modify"><code class="name flex">
<span>def <span class="ident">test_modify</span></span>(<span>clients)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_modify(clients):
    valueTables = startInfo[&#34;valueTables&#34;]
    recordId = startInfo[&#34;recordId&#34;]

    users = valueTables[USER]
    eid = recordId[CONTRIB]
    aId = recordId[ASSESS]
    reviewId = recordId[REVIEW]
    rExpertId = reviewId[EXPERT]
    rFinalId = reviewId[FINAL]
    cIdFirst = recordId[CRITERIA_ENTRY][0]
    renId = getReviewEntryId(clients, cIdFirst, rExpertId, rFinalId)

    def assertIt(cl, exp):
        assertModifyField(cl, CONTRIB, eid, TITLE, TITLE2, exp)
        assertModifyField(cl, ASSESS, aId, TITLE, TITLE_A2, exp)
        reviewerFId = G(users, FINAL)
        assertModifyField(cl, ASSESS, aId, REVIEWER_E, (reviewerFId, FINAL), exp)
        assertModifyField(
            cl, CRITERIA_ENTRY, cIdFirst, EVIDENCE, ([EVIDENCE1], EVIDENCE1), exp
        )
        for (rId, remarks) in ((rExpertId, REMARKS_E), (rFinalId, REMARKS_F)):
            assertModifyField(cl, REVIEW, rId, REMARKS, ([remarks], remarks), exp)
        for (u, reid) in renId.items():
            comments = COMMENTS_E if u == EXPERT else COMMENTS_F
            assertModifyField(
                cl, REVIEW_ENTRY, reid, COMMENTS, ([comments], comments), exp
            )

    expect = {user: False for user in USERS}
    forall(clients, expect, assertIt)</code></pre>
</details>
</dd>
<dt id="test_50_review20.test_modify2"><code class="name flex">
<span>def <span class="ident">test_modify2</span></span>(<span>clients)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_modify2(clients):
    valueTables = startInfo[&#34;valueTables&#34;]
    recordId = startInfo[&#34;recordId&#34;]

    users = valueTables[USER]
    eid = recordId[CONTRIB]
    aId = recordId[ASSESS]
    reviewId = recordId[REVIEW]
    rExpertId = reviewId[EXPERT]
    rFinalId = reviewId[FINAL]
    cIdFirst = recordId[CRITERIA_ENTRY][0]
    renId = getReviewEntryId(clients, cIdFirst, rExpertId, rFinalId)

    def assertIt(cl, exp):
        assertModifyField(cl, CONTRIB, eid, TITLE, TITLE2, exp[CONTRIB])
        assertModifyField(cl, ASSESS, aId, TITLE, TITLE_A2, exp[ASSESS])
        reviewerFId = G(users, FINAL)
        assertModifyField(
            cl, ASSESS, aId, REVIEWER_E, (reviewerFId, FINAL), exp[&#34;assign&#34;]
        )
        assertModifyField(
            cl,
            CRITERIA_ENTRY,
            cIdFirst,
            EVIDENCE,
            ([EVIDENCE1], EVIDENCE1),
            exp[CRITERIA_ENTRY],
        )
        for (rId, remarks, kind) in (
            (rExpertId, REMARKS_E, EXPERT),
            (rFinalId, REMARKS_F, FINAL),
        ):
            assertModifyField(
                cl, REVIEW, rId, REMARKS, ([remarks], remarks), exp[f&#34;{REVIEW}_{kind}&#34;]
            )
        for (kind, reid) in renId.items():
            comments = COMMENTS_E if kind == EXPERT else COMMENTS_F
            assertModifyField(
                cl,
                REVIEW_ENTRY,
                reid,
                COMMENTS,
                ([comments], comments),
                exp[f&#34;{REVIEW_ENTRY}_{kind}&#34;],
            )

    expectDefault = {user: False for user in USERS}
    expectPerKind = {
        CONTRIB: dict(expectDefault),
        ASSESS: dict(expectDefault),
        CRITERIA_ENTRY: dict(expectDefault),
        &#34;assign&#34;: dict(expectDefault),
        f&#34;{REVIEW}_{EXPERT}&#34;: dict(expectDefault),
        f&#34;{REVIEW}_{FINAL}&#34;: dict(expectDefault),
        f&#34;{REVIEW_ENTRY}_{EXPERT}&#34;: dict(expectDefault),
        f&#34;{REVIEW_ENTRY}_{FINAL}&#34;: dict(expectDefault),
    }
    expectPerKind[&#34;assign&#34;].update({user: True for user in {OFFICE}})
    expectPerKind[f&#34;{REVIEW}_{EXPERT}&#34;].update(
        {user: True for user in {EXPERT} | POWER_USERS}
    )
    expectPerKind[f&#34;{REVIEW}_{FINAL}&#34;].update(
        {user: True for user in {FINAL} | POWER_USERS}
    )
    expectPerKind[f&#34;{REVIEW_ENTRY}_{EXPERT}&#34;].update(
        {user: True for user in {EXPERT} | POWER_USERS}
    )
    expectPerKind[f&#34;{REVIEW_ENTRY}_{FINAL}&#34;].update(
        {user: True for user in {FINAL} | POWER_USERS}
    )
    expect = {}
    for (kind, expectKind) in expectPerKind.items():
        for (user, exp) in expectKind.items():
            expect.setdefault(user, {})[kind] = exp

    forall(clients, expect, assertIt)</code></pre>
</details>
</dd>
<dt id="test_50_review20.test_reviewEntryView"><code class="name flex">
<span>def <span class="ident">test_reviewEntryView</span></span>(<span>clients)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_reviewEntryView(clients):
    recordId = startInfo[&#34;recordId&#34;]

    cIds = recordId[CRITERIA_ENTRY]
    cIdFirst = cIds[0]
    reId = {}
    for user in {EXPERT, FINAL}:
        criteriaEntryInfo = getItem(clients[user], CRITERIA_ENTRY, cIdFirst)
        text = criteriaEntryInfo[&#34;text&#34;]
        reviewEntries = findReviewEntries(text)
        reId[user] = reviewEntries[user][0]

    def assertIt(cl, exp):
        user = cl.user
        for (kind, rId) in reId.items():
            value = f&#34;{kind}&#39;s comment on criteria 1&#34;
            expValue = (
                None
                if exp is None
                else value
                if user in {EXPERT, FINAL} | POWER_USERS
                else None
            )
            assertFieldValue((cl, REVIEW_ENTRY, rId), COMMENTS, expValue)

    expect = {user: None for user in USERS}
    expect.update({user: True for user in {EXPERT, FINAL} | POWER_USERS})
    forall(clients, expect, assertIt)</code></pre>
</details>
</dd>
<dt id="test_50_review20.test_reviewersDecide"><code class="name flex">
<span>def <span class="ident">test_reviewersDecide</span></span>(<span>clientsReviewer)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_reviewersDecide(clientsReviewer):
    recordId = startInfo[&#34;recordId&#34;]
    reviewId = G(recordId, REVIEW)

    assertReviewDecisions(
        clientsReviewer,
        reviewId,
        [EXPERT, FINAL],
        [REJECT, REVISE, ACCEPT, REVOKE],
        {EXPERT: True, FINAL: False},
    )</code></pre>
</details>
</dd>
<dt id="test_50_review20.test_start"><code class="name flex">
<span>def <span class="ident">test_start</span></span>(<span>clientOffice, clientOwner, clientExpert, clientFinal)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@pytest.mark.usefixtures(&#34;db&#34;)
def test_start(clientOffice, clientOwner, clientExpert, clientFinal):
    startInfo.update(start(
        clientOffice=clientOffice,
        clientOwner=clientOwner,
        clientExpert=clientExpert,
        clientFinal=clientFinal,
        users=True,
        assessment=True,
        countries=True,
        review=True,
    ))</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#domain">Domain</a></li>
<li><a href="#acts">Acts</a></li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="test_50_review20.test_decideOthers" href="#test_50_review20.test_decideOthers">test_decideOthers</a></code></li>
<li><code><a title="test_50_review20.test_expertDecides" href="#test_50_review20.test_expertDecides">test_expertDecides</a></code></li>
<li><code><a title="test_50_review20.test_finalAccepts" href="#test_50_review20.test_finalAccepts">test_finalAccepts</a></code></li>
<li><code><a title="test_50_review20.test_finalRevokes" href="#test_50_review20.test_finalRevokes">test_finalRevokes</a></code></li>
<li><code><a title="test_50_review20.test_modify" href="#test_50_review20.test_modify">test_modify</a></code></li>
<li><code><a title="test_50_review20.test_modify2" href="#test_50_review20.test_modify2">test_modify2</a></code></li>
<li><code><a title="test_50_review20.test_reviewEntryView" href="#test_50_review20.test_reviewEntryView">test_reviewEntryView</a></code></li>
<li><code><a title="test_50_review20.test_reviewersDecide" href="#test_50_review20.test_reviewersDecide">test_reviewersDecide</a></code></li>
<li><code><a title="test_50_review20.test_start" href="#test_50_review20.test_start">test_start</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.2</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>