<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.2" />
<title>test_C_assess1 API documentation</title>
<meta name="description" content="Test scenario for assessments â€¦" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>test_C_assess1</code></h1>
</header>
<section id="section-intro">
<p>Test scenario for assessments.</p>
<p>We setup and test the following scenario.</p>
<h2 id="players">Players</h2>
<ul>
<li>Lisa, office user</li>
<li>Suzan, normal user</li>
<li>Bart, normal user</li>
</ul>
<h2 id="domain">Domain</h2>
<ul>
<li>We work with a contribution and its assessment(s)</li>
<li>We start with a database with one contribution, the result of the previous scenario:
<code>tests.test_B_contrib1</code>, but we set the type of the contribution initially
to undefined</li>
</ul>
<h2 id="acts">Acts</h2>
<ul>
<li>
<p>We start with a contribution without type. Then we cannot start an assessment.
<strong>Public</strong>, <strong>Bart</strong> and <strong>Susan</strong> try the following:</p>
<ul>
<li>a nonsense command: a typo of <code>startAssessment</code></li>
<li>the command <code>startAssessment</code> but without specifying a contribution</li>
<li>the command <code>startAssessment</code> but specifying something else than a contribution</li>
<li>the command <code>startAssessment</code> but with a nonexisting contribution</li>
<li>the command <code>startAssessment</code> with the proper contribution</li>
</ul>
</li>
<li>
<p>We assign a type to the contribution.
<strong>Public</strong>, <strong>Bart</strong> and <strong>Susan</strong> try the following:</p>
<ul>
<li>the command <code>startAssessment</code> with the proper contribution</li>
</ul>
<p>Only the last action is successful, only when done by <strong>Susan</strong>.
*
Is the title filled in? <strong>Public</strong>, <strong>Bart</strong> and <strong>Suzan</strong> all check,
but Suzan is the only one that can see the fields in the assessment.
*
Does the assessment type match the contribution type? <strong>Suzan</strong> checks.
*
Do we have exactly 4 criteria entries in a good state?
*
Suzan changes the type of the contribution, which invalidates her assessment.
*
Then she adds a new assessment, ad checks whether she has now two assessments,
of which one is invalid.
*
Then she removes the new assessment.
*
She changes the contribution type back to the original value, and checks
whether her first assessment is valid again.
*
The workflow stage of the assessment should now be <code>incomplete</code>
*
<strong>Suzan</strong> tries to submit the assessment, unsuccessfully, because it is not
complete.
*
<strong>Suzan</strong> tries to fill out a score that belongs to another criterion.
*
<strong>Suzan</strong> fills out the criteria.
If not all fields are filled in, the status remains <code>incomplete</code>,
and at the end the status is complete.
*
<strong>Suzan</strong> tries to withdraw the assessment, unsuccessfully, because it has not
been submitted.
*
We check of the assessment is still private to Suzan.
*
<strong>Suzan</strong> tries to re-submit the assessment, unsuccessfully, because it has not
been submitted.
*
<strong>Suzan</strong> tries to submit the assessment as revision, unsuccessfully.
been submitted.
*
<strong>Suzan</strong> tries to submit the assessment, successfully.
*
<strong>Suzan</strong> tries to submit the assessment, unsuccessfully, because it has already
been submitted.
*
<strong>Suzan</strong> tries to withdraw the assessment, successfully.
*
<strong>Suzan</strong> tries to submit the assessment as revision, successfully.
*
<strong>Suzan</strong> tries to resubmit the assessment successfully.
*
We check of the assessment is still private to Suzan.</p>
</li>
</ul>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Test scenario for assessments.

We setup and test the following scenario.

## Players

*   Lisa, office user
*   Suzan, normal user
*   Bart, normal user

## Domain

*   We work with a contribution and its assessment(s)
*   We start with a database with one contribution, the result of the previous scenario:
    `tests.test_B_contrib1`, but we set the type of the contribution initially
    to undefined

## Acts

*   We start with a contribution without type. Then we cannot start an assessment.
    **Public**, **Bart** and **Susan** try the following:

    *   a nonsense command: a typo of `startAssessment`
    *   the command `startAssessment` but without specifying a contribution
    *   the command `startAssessment` but specifying something else than a contribution
    *   the command `startAssessment` but with a nonexisting contribution
    *   the command `startAssessment` with the proper contribution

*   We assign a type to the contribution.
    **Public**, **Bart** and **Susan** try the following:

    *   the command `startAssessment` with the proper contribution

    Only the last action is successful, only when done by **Susan**.
*   Is the title filled in? **Public**, **Bart** and **Suzan** all check,
    but Suzan is the only one that can see the fields in the assessment.
*   Does the assessment type match the contribution type? **Suzan** checks.
*   Do we have exactly 4 criteria entries in a good state?
*   Suzan changes the type of the contribution, which invalidates her assessment.
*   Then she adds a new assessment, ad checks whether she has now two assessments,
    of which one is invalid.
*   Then she removes the new assessment.
*   She changes the contribution type back to the original value, and checks
    whether her first assessment is valid again.
*   The workflow stage of the assessment should now be `incomplete`
*   **Suzan** tries to submit the assessment, unsuccessfully, because it is not
    complete.
*   **Suzan** tries to fill out a score that belongs to another criterion.
*   **Suzan** fills out the criteria.
    If not all fields are filled in, the status remains `incomplete`,
    and at the end the status is complete.
*   **Suzan** tries to withdraw the assessment, unsuccessfully, because it has not
    been submitted.
*   We check of the assessment is still private to Suzan.
*   **Suzan** tries to re-submit the assessment, unsuccessfully, because it has not
    been submitted.
*   **Suzan** tries to submit the assessment as revision, unsuccessfully.
    been submitted.
*   **Suzan** tries to submit the assessment, successfully.
*   **Suzan** tries to submit the assessment, unsuccessfully, because it has already
    been submitted.
*   **Suzan** tries to withdraw the assessment, successfully.
*   **Suzan** tries to submit the assessment as revision, successfully.
*   **Suzan** tries to resubmit the assessment successfully.
*   We check of the assessment is still private to Suzan.

&#34;&#34;&#34;

import pytest

import magic  # noqa
from helpers import (
    UNDEF_VALUE,
    WELCOME,
    CONTRIB,
    ASSESS,
    CRITERIA_ENTRY,
    BELGIUM_ID,
    EXAMPLE_TYPE,
    EXAMPLE_TYPE_ID,
    EXAMPLE_TYPE2,
    EXAMPLE_TYPE2_ID,
    isStatus,
    isWrong,
    isRight,
    startWithContrib,
    tryModifyField,
    findEid,
    findItem,
    findMaterial,
    findDetails,
    checkStage,
    accessUrl,
    fieldValue,
    checkWarning,
    getRelatedValues,
)

contribInfo = {}
assessInfo = {}
cIds = []

NEW_A_TITLE = &#34;My contribution assessed&#34;


# HELPERS


def inspectTitle(
    clientPublic, expPublic, clientBart, expBart, clientSuzan, expSuzan, title=None
):
    &#34;&#34;&#34;Check the assessment title.

    Only Susan can see the assessment, even after completion.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    expPublic, expBart, expSuzan: boolean
        Whether the corresponding clients are expected to see the title
    title: string, optional, `None`
        The expected title.
        If no title is passed, the standard title will be used.
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    field = &#34;title&#34;

    def doIt(cl, own):
        (text, fields, msgs, dummy) = findItem(cl, ASSESS, aId)
        if own:
            if title is None:
                cTitle = contribInfo[&#34;fields&#34;][field]
                aTitle = f&#34;assessment of {cTitle}&#34;
            else:
                aTitle = title

            fieldValue(fields, field, aTitle)
        else:
            fieldValue(fields, field, None)

    doIt(clientPublic, expPublic)
    doIt(clientBart, expBart)
    doIt(clientSuzan, expSuzan)


# TESTS


def test_start(clientSuzan):
    &#34;&#34;&#34;Can we find or make an item in a list of contributions?

    We also make sure that the type of contribution is not yet filled in.
    Yes.
    &#34;&#34;&#34;

    (text, fields, msgs, eid) = startWithContrib(clientSuzan)
    (text, fields, msgs, eid) = findItem(clientSuzan, CONTRIB, eid)
    contribInfo[&#34;text&#34;] = text
    contribInfo[&#34;fields&#34;] = fields
    contribInfo[&#34;msgs&#34;] = msgs
    contribInfo[&#34;eid&#34;] = eid

    assert eid is not None

    tryModifyField(
        clientSuzan, CONTRIB, eid, &#34;typeContribution&#34;, (None, UNDEF_VALUE), True
    )


@pytest.mark.parametrize(
    (&#34;url&#34;,),
    (
        (&#34;/api/command/startAssessmentXXX&#34;,),
        (&#34;/api/command/startAssessment&#34;,),
        (f&#34;/api/command/startAssessment/country/{BELGIUM_ID}&#34;,),
        (f&#34;/api/command/startAssessment/{ASSESS}/{BELGIUM_ID}&#34;,),
        (f&#34;/api/command/startAssessment/{CONTRIB}/{BELGIUM_ID}&#34;,),
        (f&#34;/api/command/startAssessment/{CONTRIB}/{{eid}}&#34;,),
    ),
)
def test_try_start(clientPublic, clientBart, clientSuzan, url):
    &#34;&#34;&#34;Try to start an assessment.

    We try out a few wrongly shaped commands, which should not succeed.

    Then the right command.
    But also this should not succeed, since the contribution type is not filled in.
    Yet we let a bunch of users try it.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    url: string(url)
        The url that is supposed to trigger the `startAssessment` command.
    &#34;&#34;&#34;

    def doIt(cl):
        eid = contribInfo[&#34;eid&#34;]
        theUrl = url.format(eid=eid)
        isWrong(cl, theUrl)

    doIt(clientPublic)
    doIt(clientBart)
    doIt(clientSuzan)


@pytest.mark.parametrize(
    (&#34;url&#34;,), ((f&#34;/api/command/startAssessment/{CONTRIB}/{{eid}}&#34;,),),
)
def test_try_start_again(
    clientPublic, clientBart, clientSuzan, url,
):
    &#34;&#34;&#34;Try to start an assessment again.

    First we let Suzan fill out the contribution type.
    Then we let a bunch of users issue the right command.
    Only Suzan should succeed.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    url: string(url)
        The url that triggers the `startAssessment` command.
    &#34;&#34;&#34;

    eid = contribInfo[&#34;eid&#34;]

    def doIt(cl, expect):
        theUrl = url.format(eid=eid)
        isStatus(cl, theUrl, expect)

    field = &#34;typeContribution&#34;
    tryModifyField(
        clientSuzan, CONTRIB, eid, field, (EXAMPLE_TYPE_ID, EXAMPLE_TYPE), True
    )

    doIt(clientPublic, False)
    doIt(clientBart, False)
    doIt(clientSuzan, True)


def test_mylistAssessment(clientPublic, clientBart, clientSuzan):
    &#34;&#34;&#34;Produce a list of my assessments.

    Suzan has one, Bart has none, and the public is not allowed to ask for
    `my` items.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    &#34;&#34;&#34;

    def doIt(cl, own, auth):
        url = f&#34;/{ASSESS}/list?action=my&#34;
        isStatus(cl, url, auth)
        (text, status, msgs) = accessUrl(cl, url, redirect=True)
        material = findMaterial(text)
        aId = findEid(text)
        if auth:
            if own:
                assert aId is not None
                assessInfo[&#34;eid&#34;] = aId
            else:
                assert &#34;0 assessments&#34; in material
        else:
            assert material == WELCOME

    doIt(clientPublic, False, False)
    doIt(clientBart, False, True)
    doIt(clientSuzan, True, True)


def test_inspectTitle(clientPublic, clientBart, clientSuzan):
    &#34;&#34;&#34;Check the assessment title.

    It is related to the contribution title.

    Only Susan can see the assessment.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    &#34;&#34;&#34;

    inspectTitle(clientPublic, False, clientBart, False, clientSuzan, True)


def test_inspectType(clientSuzan):
    &#34;&#34;&#34;Check the assessment type.

    It is equal to the contribution type.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    field = &#34;assessmentType&#34;

    (text, fields, msgs, aId) = findItem(clientSuzan, ASSESS, aId)
    fieldValue(fields, field, EXAMPLE_TYPE)


def test_modifyTitle(clientPublic, clientBart, clientSuzan):
    &#34;&#34;&#34;Try to modify the assessment title.

    This should succeed if Suzan does it.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    field = &#34;title&#34;

    def doIt(cl, own):
        tryModifyField(cl, ASSESS, aId, field, NEW_A_TITLE, own, mayRead=own)

    doIt(clientPublic, False)
    doIt(clientBart, False)
    doIt(clientSuzan, True)


def test_modifyType(clientSuzan):
    &#34;&#34;&#34;Try to modify the assessment type.

    Once an assessment is created, its type is fixed.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    field = &#34;assessmentType&#34;
    newValue = EXAMPLE_TYPE2_ID
    tryModifyField(clientSuzan, ASSESS, aId, field, (newValue, None), False)


def test_addAssessment(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can add an assessment.

    But there is already an assessment in the workflow, so it should fail.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    eid = contribInfo[&#34;eid&#34;]
    url = f&#34;/api/command/startAssessment/{CONTRIB}/{eid}&#34;
    isWrong(clientSuzan, url)


def test_criteriaEntries(clientSuzan):
    &#34;&#34;&#34;Count the number of criteria entries for this assessment.

    The criteria entry records have been generated when the assessment was created.
    For every relevant criterion, there is a corresponding criteria entry record.

    The relevant criteria depend on the contribution type.
    For this type, there are 4 criteria.
    They should be in an opened state.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    ellips = &#34;&lt;div&gt;...&lt;/div&gt;&#34;

    (text, fields, msgs, dummy) = findItem(clientSuzan, ASSESS, aId)

    dtable = &#34;criteriaEntry&#34;
    criteriaEntries = findDetails(text, dtable)
    assert len(criteriaEntries) == 4
    for (cId, material) in criteriaEntries:
        assert ellips in material


def test_modifyTypeContrib(clientSuzan):
    &#34;&#34;&#34;Try to modify the contribution type.

    This will invalidate the current assessment.
    We check that.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    cId = contribInfo[&#34;eid&#34;]
    field = &#34;typeContribution&#34;
    tryModifyField(
        clientSuzan, CONTRIB, cId, field, (EXAMPLE_TYPE2_ID, EXAMPLE_TYPE2), True
    )
    (text, fields, msgs, dummy) = findItem(clientSuzan, ASSESS, aId)
    assert checkWarning(text, NEW_A_TITLE)


def test_addAssessment2(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can add an assessment.

    But there is already an assessment in the workflow, but that is not
    a valid one anymore, so it should succeed.

    Afterwards, we delete that assessment.
    And we set the contribution type back to its original value.

    Then the original assessment is valid again.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    eid = contribInfo[&#34;eid&#34;]
    url = f&#34;/api/command/startAssessment/{CONTRIB}/{eid}&#34;
    isRight(clientSuzan, url)

    url = f&#34;/{ASSESS}/list?action=my&#34;
    (text, status, msgs) = accessUrl(clientSuzan, url, redirect=True)
    aIds = findEid(text, multiple=True)
    assert len(aIds) == 2

    aId = assessInfo[&#34;eid&#34;]
    otherAid = [i for i in aIds if i != aId][0]
    isRight(clientSuzan, f&#34;/api/{ASSESS}/delete/{otherAid}&#34;)

    url = f&#34;/{ASSESS}/list?action=my&#34;
    (text, status, msgs) = accessUrl(clientSuzan, url, redirect=True)
    aIds = findEid(text, multiple=True)
    assert len(aIds) == 1
    assert aIds[0] == aId

    cId = contribInfo[&#34;eid&#34;]
    field = &#34;typeContribution&#34;
    tryModifyField(
        clientSuzan, CONTRIB, cId, field, (EXAMPLE_TYPE_ID, EXAMPLE_TYPE), True
    )
    (text, fields, msgs, dummy) = findItem(clientSuzan, ASSESS, aId)
    assert not checkWarning(text, NEW_A_TITLE)


def test_fillCriteriaEntries(clientSuzan):
    &#34;&#34;&#34;Fill out the criteria entries.

    Start with checking the stage,

    Before filling out the last field of the last criterion,
    check the stage.
    After completion, check the stage again.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    ellips = &#34;&lt;div&gt;...&lt;/div&gt;&#34;

    (text, fields, msgs, dummy) = checkStage(clientSuzan, ASSESS, aId, &#34;incomplete&#34;)

    dtable = &#34;criteriaEntry&#34;
    criteriaEntries = findDetails(text, dtable)
    assert len(criteriaEntries) == 4

    for (i, (cId, material)) in enumerate(criteriaEntries):
        assert ellips in material
        theEvidence = [f&#34;evidence for {i + 1}&#34;, &#34;see the internet&#34;]
        theEvidenceRep = &#34;,&#34;.join(theEvidence)
        field = &#34;evidence&#34;
        tryModifyField(
            clientSuzan, CRITERIA_ENTRY, cId, field, (theEvidence, theEvidenceRep), True
        )
        cIds.append(cId)


def test_fillScore(clientSuzan):
    &#34;&#34;&#34;Fill out the score for the first criterion.

    We collect the possible values and pick one to fill in and check
    whether it has arrived.
    &#34;&#34;&#34;

    cId = cIds[0]
    field = &#34;score&#34;
    scores = getRelatedValues(clientSuzan, CRITERIA_ENTRY, cId, field)
    (scoreValue, scoreId) = sorted(scores.items())[0]
    tryModifyField(clientSuzan, CRITERIA_ENTRY, cId, field, (scoreId, scoreValue), True)


def test_fillScoreWrong(clientSuzan):
    &#34;&#34;&#34;Try to fill out the score for the first criterion, but with a wrong score value.

    We pick a score that does not belong to this criterion, but to another one.

    This should fail.

    !!! note &#34;Not tested beofre&#34;
        This is the first time that we use a value table where the possible
        values are constrained by another constraint:

        Only those scores are eligible that have the same `criteria` master as
        the `criteriaEntry` record.
    &#34;&#34;&#34;

    cId = cIds[0]
    cIdx = cIds[1]
    field = &#34;score&#34;

    (text, fields, msgs, eid) = findItem(clientSuzan, CRITERIA_ENTRY, cId)

    scores = getRelatedValues(clientSuzan, CRITERIA_ENTRY, cIdx, field)
    (scoreValue, scoreId) = sorted(scores.items())[0]
    tryModifyField(
        clientSuzan, CRITERIA_ENTRY, cId, field, (scoreId, scoreValue), False
    )


def test_submitAssessment(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can submit this assessment.

    But the assessment is not yet complete, so it should fail.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/submitAssessment/{ASSESS}/{aId}&#34;
    isWrong(clientSuzan, url)


def test_complete(clientSuzan):
    &#34;&#34;&#34;Fill out all scores.

    Before filling out the last one, check if the status is still incomplete.
    After filling out all scores, check if the status is complete.
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    field = &#34;score&#34;
    nCId = len(cIds)

    for (i, cId) in enumerate(cIds):
        scores = getRelatedValues(clientSuzan, CRITERIA_ENTRY, cId, field)
        (scoreValue, scoreId) = sorted(scores.items())[1]
        if i == nCId - 1:
            checkStage(clientSuzan, ASSESS, aId, &#34;incomplete&#34;)

        tryModifyField(
            clientSuzan, CRITERIA_ENTRY, cId, field, (scoreId, scoreValue), True
        )
    checkStage(clientSuzan, ASSESS, aId, &#34;complete&#34;)


def test_withdrawAssessment(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can withdraw this assessment.

    But the assessment is not yet submitted, so it should fail.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/withdrawAssessment/{ASSESS}/{aId}&#34;
    isWrong(clientSuzan, url)


def test_inspectTitle2(clientPublic, clientBart, clientSuzan):
    &#34;&#34;&#34;Check the assessment title (again).

    Only Susan can see the assessment, even after completion.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    &#34;&#34;&#34;

    inspectTitle(
        clientPublic, False, clientBart, False, clientSuzan, True, title=NEW_A_TITLE
    )


def test_resubmitAssessment(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can re-submit this assessment.

    The assessment is complete, but has not yet been submitted,
    so it cannot be resubmitted.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/resubmitAssessment/{ASSESS}/{aId}&#34;
    isWrong(clientSuzan, url)


def test_submitAssessmentRevised(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can submit this assessment as a revision.

    The assessment is complete, but it is not a revision,
    so it cannot be submitted as a revision.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/submitRevised/{ASSESS}/{aId}&#34;
    isWrong(clientSuzan, url)


def test_submitAssessment2(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can submit this assessment.

    The assessment is complete, so it should succeed.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/submitAssessment/{ASSESS}/{aId}&#34;
    isRight(clientSuzan, url)


def Xtest_withdrawAssessment2(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can withdraw this assessment.

    Yes.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/withdrawAssessment/{ASSESS}/{aId}&#34;
    isRight(clientSuzan, url)


def Xest_submitAssessmentRevised2(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can submit this assessment as a revision.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/submitRevised/{ASSESS}/{aId}&#34;
    isWrong(clientSuzan, url)


def Xtest_resubmitAssessment2(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can re-submit this assessment.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/resubmitAssessment/{ASSESS}/{aId}&#34;
    isRight(clientSuzan, url)


def test_inspectTitle3(clientPublic, clientBart, clientSuzan):
    &#34;&#34;&#34;Check the assessment title (again).

    Only Susan can see the assessment, even after submission.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    &#34;&#34;&#34;

    inspectTitle(
        clientPublic, False, clientBart, False, clientSuzan, True, title=NEW_A_TITLE
    )</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="test_C_assess1.Xest_submitAssessmentRevised2"><code class="name flex">
<span>def <span class="ident">Xest_submitAssessmentRevised2</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check whether Suzan can submit this assessment as a revision.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Xest_submitAssessmentRevised2(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can submit this assessment as a revision.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/submitRevised/{ASSESS}/{aId}&#34;
    isWrong(clientSuzan, url)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.Xtest_resubmitAssessment2"><code class="name flex">
<span>def <span class="ident">Xtest_resubmitAssessment2</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check whether Suzan can re-submit this assessment.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Xtest_resubmitAssessment2(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can re-submit this assessment.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/resubmitAssessment/{ASSESS}/{aId}&#34;
    isRight(clientSuzan, url)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.Xtest_withdrawAssessment2"><code class="name flex">
<span>def <span class="ident">Xtest_withdrawAssessment2</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check whether Suzan can withdraw this assessment.</p>
<p>Yes.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def Xtest_withdrawAssessment2(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can withdraw this assessment.

    Yes.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/withdrawAssessment/{ASSESS}/{aId}&#34;
    isRight(clientSuzan, url)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.inspectTitle"><code class="name flex">
<span>def <span class="ident">inspectTitle</span></span>(<span>clientPublic, expPublic, clientBart, expBart, clientSuzan, expSuzan, title=None)</span>
</code></dt>
<dd>
<section class="desc"><p>Check the assessment title.</p>
<p>Only Susan can see the assessment, even after completion.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientPublic</code></strong>, <strong><code>clientBart</code></strong>, <strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
<dt><strong><code>expPublic</code></strong>, <strong><code>expBart</code></strong>, <strong><code>expSuzan</code></strong> :&ensp;<code>boolean</code></dt>
<dd>Whether the corresponding clients are expected to see the title</dd>
<dt><strong><code>title</code></strong> :&ensp;<code>string</code>, optional, <code>None</code></dt>
<dd>The expected title.
If no title is passed, the standard title will be used.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def inspectTitle(
    clientPublic, expPublic, clientBart, expBart, clientSuzan, expSuzan, title=None
):
    &#34;&#34;&#34;Check the assessment title.

    Only Susan can see the assessment, even after completion.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    expPublic, expBart, expSuzan: boolean
        Whether the corresponding clients are expected to see the title
    title: string, optional, `None`
        The expected title.
        If no title is passed, the standard title will be used.
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    field = &#34;title&#34;

    def doIt(cl, own):
        (text, fields, msgs, dummy) = findItem(cl, ASSESS, aId)
        if own:
            if title is None:
                cTitle = contribInfo[&#34;fields&#34;][field]
                aTitle = f&#34;assessment of {cTitle}&#34;
            else:
                aTitle = title

            fieldValue(fields, field, aTitle)
        else:
            fieldValue(fields, field, None)

    doIt(clientPublic, expPublic)
    doIt(clientBart, expBart)
    doIt(clientSuzan, expSuzan)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_addAssessment"><code class="name flex">
<span>def <span class="ident">test_addAssessment</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check whether Suzan can add an assessment.</p>
<p>But there is already an assessment in the workflow, so it should fail.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_addAssessment(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can add an assessment.

    But there is already an assessment in the workflow, so it should fail.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    eid = contribInfo[&#34;eid&#34;]
    url = f&#34;/api/command/startAssessment/{CONTRIB}/{eid}&#34;
    isWrong(clientSuzan, url)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_addAssessment2"><code class="name flex">
<span>def <span class="ident">test_addAssessment2</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check whether Suzan can add an assessment.</p>
<p>But there is already an assessment in the workflow, but that is not
a valid one anymore, so it should succeed.</p>
<p>Afterwards, we delete that assessment.
And we set the contribution type back to its original value.</p>
<p>Then the original assessment is valid again.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_addAssessment2(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can add an assessment.

    But there is already an assessment in the workflow, but that is not
    a valid one anymore, so it should succeed.

    Afterwards, we delete that assessment.
    And we set the contribution type back to its original value.

    Then the original assessment is valid again.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    eid = contribInfo[&#34;eid&#34;]
    url = f&#34;/api/command/startAssessment/{CONTRIB}/{eid}&#34;
    isRight(clientSuzan, url)

    url = f&#34;/{ASSESS}/list?action=my&#34;
    (text, status, msgs) = accessUrl(clientSuzan, url, redirect=True)
    aIds = findEid(text, multiple=True)
    assert len(aIds) == 2

    aId = assessInfo[&#34;eid&#34;]
    otherAid = [i for i in aIds if i != aId][0]
    isRight(clientSuzan, f&#34;/api/{ASSESS}/delete/{otherAid}&#34;)

    url = f&#34;/{ASSESS}/list?action=my&#34;
    (text, status, msgs) = accessUrl(clientSuzan, url, redirect=True)
    aIds = findEid(text, multiple=True)
    assert len(aIds) == 1
    assert aIds[0] == aId

    cId = contribInfo[&#34;eid&#34;]
    field = &#34;typeContribution&#34;
    tryModifyField(
        clientSuzan, CONTRIB, cId, field, (EXAMPLE_TYPE_ID, EXAMPLE_TYPE), True
    )
    (text, fields, msgs, dummy) = findItem(clientSuzan, ASSESS, aId)
    assert not checkWarning(text, NEW_A_TITLE)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_complete"><code class="name flex">
<span>def <span class="ident">test_complete</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Fill out all scores.</p>
<p>Before filling out the last one, check if the status is still incomplete.
After filling out all scores, check if the status is complete.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_complete(clientSuzan):
    &#34;&#34;&#34;Fill out all scores.

    Before filling out the last one, check if the status is still incomplete.
    After filling out all scores, check if the status is complete.
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    field = &#34;score&#34;
    nCId = len(cIds)

    for (i, cId) in enumerate(cIds):
        scores = getRelatedValues(clientSuzan, CRITERIA_ENTRY, cId, field)
        (scoreValue, scoreId) = sorted(scores.items())[1]
        if i == nCId - 1:
            checkStage(clientSuzan, ASSESS, aId, &#34;incomplete&#34;)

        tryModifyField(
            clientSuzan, CRITERIA_ENTRY, cId, field, (scoreId, scoreValue), True
        )
    checkStage(clientSuzan, ASSESS, aId, &#34;complete&#34;)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_criteriaEntries"><code class="name flex">
<span>def <span class="ident">test_criteriaEntries</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Count the number of criteria entries for this assessment.</p>
<p>The criteria entry records have been generated when the assessment was created.
For every relevant criterion, there is a corresponding criteria entry record.</p>
<p>The relevant criteria depend on the contribution type.
For this type, there are 4 criteria.
They should be in an opened state.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_criteriaEntries(clientSuzan):
    &#34;&#34;&#34;Count the number of criteria entries for this assessment.

    The criteria entry records have been generated when the assessment was created.
    For every relevant criterion, there is a corresponding criteria entry record.

    The relevant criteria depend on the contribution type.
    For this type, there are 4 criteria.
    They should be in an opened state.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    ellips = &#34;&lt;div&gt;...&lt;/div&gt;&#34;

    (text, fields, msgs, dummy) = findItem(clientSuzan, ASSESS, aId)

    dtable = &#34;criteriaEntry&#34;
    criteriaEntries = findDetails(text, dtable)
    assert len(criteriaEntries) == 4
    for (cId, material) in criteriaEntries:
        assert ellips in material</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_fillCriteriaEntries"><code class="name flex">
<span>def <span class="ident">test_fillCriteriaEntries</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Fill out the criteria entries.</p>
<p>Start with checking the stage,</p>
<p>Before filling out the last field of the last criterion,
check the stage.
After completion, check the stage again.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_fillCriteriaEntries(clientSuzan):
    &#34;&#34;&#34;Fill out the criteria entries.

    Start with checking the stage,

    Before filling out the last field of the last criterion,
    check the stage.
    After completion, check the stage again.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    ellips = &#34;&lt;div&gt;...&lt;/div&gt;&#34;

    (text, fields, msgs, dummy) = checkStage(clientSuzan, ASSESS, aId, &#34;incomplete&#34;)

    dtable = &#34;criteriaEntry&#34;
    criteriaEntries = findDetails(text, dtable)
    assert len(criteriaEntries) == 4

    for (i, (cId, material)) in enumerate(criteriaEntries):
        assert ellips in material
        theEvidence = [f&#34;evidence for {i + 1}&#34;, &#34;see the internet&#34;]
        theEvidenceRep = &#34;,&#34;.join(theEvidence)
        field = &#34;evidence&#34;
        tryModifyField(
            clientSuzan, CRITERIA_ENTRY, cId, field, (theEvidence, theEvidenceRep), True
        )
        cIds.append(cId)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_fillScore"><code class="name flex">
<span>def <span class="ident">test_fillScore</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Fill out the score for the first criterion.</p>
<p>We collect the possible values and pick one to fill in and check
whether it has arrived.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_fillScore(clientSuzan):
    &#34;&#34;&#34;Fill out the score for the first criterion.

    We collect the possible values and pick one to fill in and check
    whether it has arrived.
    &#34;&#34;&#34;

    cId = cIds[0]
    field = &#34;score&#34;
    scores = getRelatedValues(clientSuzan, CRITERIA_ENTRY, cId, field)
    (scoreValue, scoreId) = sorted(scores.items())[0]
    tryModifyField(clientSuzan, CRITERIA_ENTRY, cId, field, (scoreId, scoreValue), True)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_fillScoreWrong"><code class="name flex">
<span>def <span class="ident">test_fillScoreWrong</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Try to fill out the score for the first criterion, but with a wrong score value.</p>
<p>We pick a score that does not belong to this criterion, but to another one.</p>
<p>This should fail.</p>
<div class="admonition note">
<p class="admonition-title">Not tested beofre</p>
<p>This is the first time that we use a value table where the possible
values are constrained by another constraint:</p>
<p>Only those scores are eligible that have the same <code>criteria</code> master as
the <code>criteriaEntry</code> record.</p>
</div></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_fillScoreWrong(clientSuzan):
    &#34;&#34;&#34;Try to fill out the score for the first criterion, but with a wrong score value.

    We pick a score that does not belong to this criterion, but to another one.

    This should fail.

    !!! note &#34;Not tested beofre&#34;
        This is the first time that we use a value table where the possible
        values are constrained by another constraint:

        Only those scores are eligible that have the same `criteria` master as
        the `criteriaEntry` record.
    &#34;&#34;&#34;

    cId = cIds[0]
    cIdx = cIds[1]
    field = &#34;score&#34;

    (text, fields, msgs, eid) = findItem(clientSuzan, CRITERIA_ENTRY, cId)

    scores = getRelatedValues(clientSuzan, CRITERIA_ENTRY, cIdx, field)
    (scoreValue, scoreId) = sorted(scores.items())[0]
    tryModifyField(
        clientSuzan, CRITERIA_ENTRY, cId, field, (scoreId, scoreValue), False
    )</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_inspectTitle"><code class="name flex">
<span>def <span class="ident">test_inspectTitle</span></span>(<span>clientPublic, clientBart, clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check the assessment title.</p>
<p>It is related to the contribution title.</p>
<p>Only Susan can see the assessment.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientPublic</code></strong>, <strong><code>clientBart</code></strong>, <strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_inspectTitle(clientPublic, clientBart, clientSuzan):
    &#34;&#34;&#34;Check the assessment title.

    It is related to the contribution title.

    Only Susan can see the assessment.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    &#34;&#34;&#34;

    inspectTitle(clientPublic, False, clientBart, False, clientSuzan, True)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_inspectTitle2"><code class="name flex">
<span>def <span class="ident">test_inspectTitle2</span></span>(<span>clientPublic, clientBart, clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check the assessment title (again).</p>
<p>Only Susan can see the assessment, even after completion.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientPublic</code></strong>, <strong><code>clientBart</code></strong>, <strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_inspectTitle2(clientPublic, clientBart, clientSuzan):
    &#34;&#34;&#34;Check the assessment title (again).

    Only Susan can see the assessment, even after completion.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    &#34;&#34;&#34;

    inspectTitle(
        clientPublic, False, clientBart, False, clientSuzan, True, title=NEW_A_TITLE
    )</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_inspectTitle3"><code class="name flex">
<span>def <span class="ident">test_inspectTitle3</span></span>(<span>clientPublic, clientBart, clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check the assessment title (again).</p>
<p>Only Susan can see the assessment, even after submission.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientPublic</code></strong>, <strong><code>clientBart</code></strong>, <strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_inspectTitle3(clientPublic, clientBart, clientSuzan):
    &#34;&#34;&#34;Check the assessment title (again).

    Only Susan can see the assessment, even after submission.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    &#34;&#34;&#34;

    inspectTitle(
        clientPublic, False, clientBart, False, clientSuzan, True, title=NEW_A_TITLE
    )</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_inspectType"><code class="name flex">
<span>def <span class="ident">test_inspectType</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check the assessment type.</p>
<p>It is equal to the contribution type.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_inspectType(clientSuzan):
    &#34;&#34;&#34;Check the assessment type.

    It is equal to the contribution type.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    field = &#34;assessmentType&#34;

    (text, fields, msgs, aId) = findItem(clientSuzan, ASSESS, aId)
    fieldValue(fields, field, EXAMPLE_TYPE)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_modifyTitle"><code class="name flex">
<span>def <span class="ident">test_modifyTitle</span></span>(<span>clientPublic, clientBart, clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Try to modify the assessment title.</p>
<p>This should succeed if Suzan does it.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientPublic</code></strong>, <strong><code>clientBart</code></strong>, <strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_modifyTitle(clientPublic, clientBart, clientSuzan):
    &#34;&#34;&#34;Try to modify the assessment title.

    This should succeed if Suzan does it.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    field = &#34;title&#34;

    def doIt(cl, own):
        tryModifyField(cl, ASSESS, aId, field, NEW_A_TITLE, own, mayRead=own)

    doIt(clientPublic, False)
    doIt(clientBart, False)
    doIt(clientSuzan, True)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_modifyType"><code class="name flex">
<span>def <span class="ident">test_modifyType</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Try to modify the assessment type.</p>
<p>Once an assessment is created, its type is fixed.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_modifyType(clientSuzan):
    &#34;&#34;&#34;Try to modify the assessment type.

    Once an assessment is created, its type is fixed.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    field = &#34;assessmentType&#34;
    newValue = EXAMPLE_TYPE2_ID
    tryModifyField(clientSuzan, ASSESS, aId, field, (newValue, None), False)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_modifyTypeContrib"><code class="name flex">
<span>def <span class="ident">test_modifyTypeContrib</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Try to modify the contribution type.</p>
<p>This will invalidate the current assessment.
We check that.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_modifyTypeContrib(clientSuzan):
    &#34;&#34;&#34;Try to modify the contribution type.

    This will invalidate the current assessment.
    We check that.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    cId = contribInfo[&#34;eid&#34;]
    field = &#34;typeContribution&#34;
    tryModifyField(
        clientSuzan, CONTRIB, cId, field, (EXAMPLE_TYPE2_ID, EXAMPLE_TYPE2), True
    )
    (text, fields, msgs, dummy) = findItem(clientSuzan, ASSESS, aId)
    assert checkWarning(text, NEW_A_TITLE)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_mylistAssessment"><code class="name flex">
<span>def <span class="ident">test_mylistAssessment</span></span>(<span>clientPublic, clientBart, clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Produce a list of my assessments.</p>
<p>Suzan has one, Bart has none, and the public is not allowed to ask for
<code>my</code> items.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientPublic</code></strong>, <strong><code>clientBart</code></strong>, <strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_mylistAssessment(clientPublic, clientBart, clientSuzan):
    &#34;&#34;&#34;Produce a list of my assessments.

    Suzan has one, Bart has none, and the public is not allowed to ask for
    `my` items.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    &#34;&#34;&#34;

    def doIt(cl, own, auth):
        url = f&#34;/{ASSESS}/list?action=my&#34;
        isStatus(cl, url, auth)
        (text, status, msgs) = accessUrl(cl, url, redirect=True)
        material = findMaterial(text)
        aId = findEid(text)
        if auth:
            if own:
                assert aId is not None
                assessInfo[&#34;eid&#34;] = aId
            else:
                assert &#34;0 assessments&#34; in material
        else:
            assert material == WELCOME

    doIt(clientPublic, False, False)
    doIt(clientBart, False, True)
    doIt(clientSuzan, True, True)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_resubmitAssessment"><code class="name flex">
<span>def <span class="ident">test_resubmitAssessment</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check whether Suzan can re-submit this assessment.</p>
<p>The assessment is complete, but has not yet been submitted,
so it cannot be resubmitted.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_resubmitAssessment(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can re-submit this assessment.

    The assessment is complete, but has not yet been submitted,
    so it cannot be resubmitted.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/resubmitAssessment/{ASSESS}/{aId}&#34;
    isWrong(clientSuzan, url)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_start"><code class="name flex">
<span>def <span class="ident">test_start</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Can we find or make an item in a list of contributions?</p>
<p>We also make sure that the type of contribution is not yet filled in.
Yes.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_start(clientSuzan):
    &#34;&#34;&#34;Can we find or make an item in a list of contributions?

    We also make sure that the type of contribution is not yet filled in.
    Yes.
    &#34;&#34;&#34;

    (text, fields, msgs, eid) = startWithContrib(clientSuzan)
    (text, fields, msgs, eid) = findItem(clientSuzan, CONTRIB, eid)
    contribInfo[&#34;text&#34;] = text
    contribInfo[&#34;fields&#34;] = fields
    contribInfo[&#34;msgs&#34;] = msgs
    contribInfo[&#34;eid&#34;] = eid

    assert eid is not None

    tryModifyField(
        clientSuzan, CONTRIB, eid, &#34;typeContribution&#34;, (None, UNDEF_VALUE), True
    )</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_submitAssessment"><code class="name flex">
<span>def <span class="ident">test_submitAssessment</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check whether Suzan can submit this assessment.</p>
<p>But the assessment is not yet complete, so it should fail.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_submitAssessment(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can submit this assessment.

    But the assessment is not yet complete, so it should fail.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/submitAssessment/{ASSESS}/{aId}&#34;
    isWrong(clientSuzan, url)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_submitAssessment2"><code class="name flex">
<span>def <span class="ident">test_submitAssessment2</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check whether Suzan can submit this assessment.</p>
<p>The assessment is complete, so it should succeed.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_submitAssessment2(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can submit this assessment.

    The assessment is complete, so it should succeed.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/submitAssessment/{ASSESS}/{aId}&#34;
    isRight(clientSuzan, url)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_submitAssessmentRevised"><code class="name flex">
<span>def <span class="ident">test_submitAssessmentRevised</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check whether Suzan can submit this assessment as a revision.</p>
<p>The assessment is complete, but it is not a revision,
so it cannot be submitted as a revision.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_submitAssessmentRevised(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can submit this assessment as a revision.

    The assessment is complete, but it is not a revision,
    so it cannot be submitted as a revision.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/submitRevised/{ASSESS}/{aId}&#34;
    isWrong(clientSuzan, url)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_try_start"><code class="name flex">
<span>def <span class="ident">test_try_start</span></span>(<span>clientPublic, clientBart, clientSuzan, url)</span>
</code></dt>
<dd>
<section class="desc"><p>Try to start an assessment.</p>
<p>We try out a few wrongly shaped commands, which should not succeed.</p>
<p>Then the right command.
But also this should not succeed, since the contribution type is not filled in.
Yet we let a bunch of users try it.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientPublic</code></strong>, <strong><code>clientBart</code></strong>, <strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
<dt><strong><code>url</code></strong> :&ensp;<code>string</code>(<code>url</code>)</dt>
<dd>The url that is supposed to trigger the <code>startAssessment</code> command.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@pytest.mark.parametrize(
    (&#34;url&#34;,),
    (
        (&#34;/api/command/startAssessmentXXX&#34;,),
        (&#34;/api/command/startAssessment&#34;,),
        (f&#34;/api/command/startAssessment/country/{BELGIUM_ID}&#34;,),
        (f&#34;/api/command/startAssessment/{ASSESS}/{BELGIUM_ID}&#34;,),
        (f&#34;/api/command/startAssessment/{CONTRIB}/{BELGIUM_ID}&#34;,),
        (f&#34;/api/command/startAssessment/{CONTRIB}/{{eid}}&#34;,),
    ),
)
def test_try_start(clientPublic, clientBart, clientSuzan, url):
    &#34;&#34;&#34;Try to start an assessment.

    We try out a few wrongly shaped commands, which should not succeed.

    Then the right command.
    But also this should not succeed, since the contribution type is not filled in.
    Yet we let a bunch of users try it.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    url: string(url)
        The url that is supposed to trigger the `startAssessment` command.
    &#34;&#34;&#34;

    def doIt(cl):
        eid = contribInfo[&#34;eid&#34;]
        theUrl = url.format(eid=eid)
        isWrong(cl, theUrl)

    doIt(clientPublic)
    doIt(clientBart)
    doIt(clientSuzan)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_try_start_again"><code class="name flex">
<span>def <span class="ident">test_try_start_again</span></span>(<span>clientPublic, clientBart, clientSuzan, url)</span>
</code></dt>
<dd>
<section class="desc"><p>Try to start an assessment again.</p>
<p>First we let Suzan fill out the contribution type.
Then we let a bunch of users issue the right command.
Only Suzan should succeed.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientPublic</code></strong>, <strong><code>clientBart</code></strong>, <strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
<dt><strong><code>url</code></strong> :&ensp;<code>string</code>(<code>url</code>)</dt>
<dd>The url that triggers the <code>startAssessment</code> command.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@pytest.mark.parametrize(
    (&#34;url&#34;,), ((f&#34;/api/command/startAssessment/{CONTRIB}/{{eid}}&#34;,),),
)
def test_try_start_again(
    clientPublic, clientBart, clientSuzan, url,
):
    &#34;&#34;&#34;Try to start an assessment again.

    First we let Suzan fill out the contribution type.
    Then we let a bunch of users issue the right command.
    Only Suzan should succeed.

    Parameters
    ----------
    clientPublic, clientBart, clientSuzan: fixture
    url: string(url)
        The url that triggers the `startAssessment` command.
    &#34;&#34;&#34;

    eid = contribInfo[&#34;eid&#34;]

    def doIt(cl, expect):
        theUrl = url.format(eid=eid)
        isStatus(cl, theUrl, expect)

    field = &#34;typeContribution&#34;
    tryModifyField(
        clientSuzan, CONTRIB, eid, field, (EXAMPLE_TYPE_ID, EXAMPLE_TYPE), True
    )

    doIt(clientPublic, False)
    doIt(clientBart, False)
    doIt(clientSuzan, True)</code></pre>
</details>
</dd>
<dt id="test_C_assess1.test_withdrawAssessment"><code class="name flex">
<span>def <span class="ident">test_withdrawAssessment</span></span>(<span>clientSuzan)</span>
</code></dt>
<dd>
<section class="desc"><p>Check whether Suzan can withdraw this assessment.</p>
<p>But the assessment is not yet submitted, so it should fail.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>clientSuzan</code></strong> :&ensp;<code>fixture</code></dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_withdrawAssessment(clientSuzan):
    &#34;&#34;&#34;Check whether Suzan can withdraw this assessment.

    But the assessment is not yet submitted, so it should fail.

    Parameters
    ----------
    clientSuzan: fixture
    &#34;&#34;&#34;

    aId = assessInfo[&#34;eid&#34;]
    url = f&#34;/api/command/withdrawAssessment/{ASSESS}/{aId}&#34;
    isWrong(clientSuzan, url)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#players">Players</a></li>
<li><a href="#domain">Domain</a></li>
<li><a href="#acts">Acts</a></li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="test_C_assess1.Xest_submitAssessmentRevised2" href="#test_C_assess1.Xest_submitAssessmentRevised2">Xest_submitAssessmentRevised2</a></code></li>
<li><code><a title="test_C_assess1.Xtest_resubmitAssessment2" href="#test_C_assess1.Xtest_resubmitAssessment2">Xtest_resubmitAssessment2</a></code></li>
<li><code><a title="test_C_assess1.Xtest_withdrawAssessment2" href="#test_C_assess1.Xtest_withdrawAssessment2">Xtest_withdrawAssessment2</a></code></li>
<li><code><a title="test_C_assess1.inspectTitle" href="#test_C_assess1.inspectTitle">inspectTitle</a></code></li>
<li><code><a title="test_C_assess1.test_addAssessment" href="#test_C_assess1.test_addAssessment">test_addAssessment</a></code></li>
<li><code><a title="test_C_assess1.test_addAssessment2" href="#test_C_assess1.test_addAssessment2">test_addAssessment2</a></code></li>
<li><code><a title="test_C_assess1.test_complete" href="#test_C_assess1.test_complete">test_complete</a></code></li>
<li><code><a title="test_C_assess1.test_criteriaEntries" href="#test_C_assess1.test_criteriaEntries">test_criteriaEntries</a></code></li>
<li><code><a title="test_C_assess1.test_fillCriteriaEntries" href="#test_C_assess1.test_fillCriteriaEntries">test_fillCriteriaEntries</a></code></li>
<li><code><a title="test_C_assess1.test_fillScore" href="#test_C_assess1.test_fillScore">test_fillScore</a></code></li>
<li><code><a title="test_C_assess1.test_fillScoreWrong" href="#test_C_assess1.test_fillScoreWrong">test_fillScoreWrong</a></code></li>
<li><code><a title="test_C_assess1.test_inspectTitle" href="#test_C_assess1.test_inspectTitle">test_inspectTitle</a></code></li>
<li><code><a title="test_C_assess1.test_inspectTitle2" href="#test_C_assess1.test_inspectTitle2">test_inspectTitle2</a></code></li>
<li><code><a title="test_C_assess1.test_inspectTitle3" href="#test_C_assess1.test_inspectTitle3">test_inspectTitle3</a></code></li>
<li><code><a title="test_C_assess1.test_inspectType" href="#test_C_assess1.test_inspectType">test_inspectType</a></code></li>
<li><code><a title="test_C_assess1.test_modifyTitle" href="#test_C_assess1.test_modifyTitle">test_modifyTitle</a></code></li>
<li><code><a title="test_C_assess1.test_modifyType" href="#test_C_assess1.test_modifyType">test_modifyType</a></code></li>
<li><code><a title="test_C_assess1.test_modifyTypeContrib" href="#test_C_assess1.test_modifyTypeContrib">test_modifyTypeContrib</a></code></li>
<li><code><a title="test_C_assess1.test_mylistAssessment" href="#test_C_assess1.test_mylistAssessment">test_mylistAssessment</a></code></li>
<li><code><a title="test_C_assess1.test_resubmitAssessment" href="#test_C_assess1.test_resubmitAssessment">test_resubmitAssessment</a></code></li>
<li><code><a title="test_C_assess1.test_start" href="#test_C_assess1.test_start">test_start</a></code></li>
<li><code><a title="test_C_assess1.test_submitAssessment" href="#test_C_assess1.test_submitAssessment">test_submitAssessment</a></code></li>
<li><code><a title="test_C_assess1.test_submitAssessment2" href="#test_C_assess1.test_submitAssessment2">test_submitAssessment2</a></code></li>
<li><code><a title="test_C_assess1.test_submitAssessmentRevised" href="#test_C_assess1.test_submitAssessmentRevised">test_submitAssessmentRevised</a></code></li>
<li><code><a title="test_C_assess1.test_try_start" href="#test_C_assess1.test_try_start">test_try_start</a></code></li>
<li><code><a title="test_C_assess1.test_try_start_again" href="#test_C_assess1.test_try_start_again">test_try_start_again</a></code></li>
<li><code><a title="test_C_assess1.test_withdrawAssessment" href="#test_C_assess1.test_withdrawAssessment">test_withdrawAssessment</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.2</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>