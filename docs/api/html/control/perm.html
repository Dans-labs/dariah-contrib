<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>control.perm API documentation</title>
<meta name="description" content="Permission library â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>control.perm</code></h1>
</header>
<section id="section-intro">
<p>Permission library</p>
<ul>
<li>Computing permissions</li>
<li>Support for the authorization system</li>
</ul>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Permission library

*   Computing permissions
*   Support for the authorization system
&#34;&#34;&#34;

from config import Config as C, Names as N
from control.utils import pick as G

CT = C.tables
CP = C.perm

DEFAULT_PERM = CP.default
TABLE_PERM = CT.perm

NOBODY = N.nobody
UNAUTH = N.public
AUTH = N.auth
EDIT = N.edit
OWN = N.own
COORD = N.coord
OFFICE = N.office
SYSTEM = N.system
ROOT = N.root

ALLOW_OUR = set(CT.userTables) | set(CT.userEntryTables)


def checkTable(
    auth, table
):
    &#34;&#34;&#34;Verify whether user&#39;s credentials match the requirements for a table.

    Every table can only be listed on the interface if the user has permissions
    for it.
    The table permissions are configured in `tables.yaml`, under the key `perm`.
    For each table the minimal role is stated that can access the table.

    If a table is not permitted, then its records are also not permitted,
    neither are fields in those records.

    However, this holds for the generic interface. Individual tables and records
    and fields may be regulated in addition by
    `control.workflow.apply.WorkflowItem` conditions,
    which can open up and close off material.

    Parameters
    ----------
    auth: object
        The `control.auth.Auth` singleton, from which the group of the current
        user can be obtained.
    table: string
        The table for which permission is required.

    Returns
    -------
    boolean
    &#34;&#34;&#34;

    require = G(TABLE_PERM, table)
    if require is None:
        return False

    if require == UNAUTH:
        return True

    group = auth.groupRep()

    if require == NOBODY:
        return False

    if require == AUTH:
        return group != UNAUTH

    isSuper = group in {OFFICE, SYSTEM, ROOT}

    if require == OFFICE:
        return isSuper

    if require == SYSTEM:
        return group in {SYSTEM, ROOT}

    if require == ROOT:
        return group == ROOT

    if require == COORD:
        return group == COORD or isSuper


def checkPerm(
    require, perm,
):
    &#34;&#34;&#34;Verify whether user&#39;s credentials match the requirements.

    Parameters
    ----------
    require: string
        The required permission level (see the perm.yaml configuration file under
        the key `roles`).
    perm: dict
        User attributes, in paticular `group` which is the role a user can play on the
        basis of his/her identity.
        But it also contains attributes that links a user to ceertain records, e.g. the
        records of which (s)he is creator/editor, or National Coordinator.

    Returns
    -------
    boolean
    &#34;&#34;&#34;

    if require == UNAUTH:
        return True

    group = G(perm, N.group)

    if require == NOBODY:
        return False

    if require == AUTH:
        return group != UNAUTH

    isSuper = group in {OFFICE, SYSTEM, ROOT}

    if require == OFFICE:
        return isSuper

    if require == SYSTEM:
        return group in {SYSTEM, ROOT}

    if require == ROOT:
        return group == ROOT

    if require == EDIT:
        return group != UNAUTH and (G(perm, N.isEdit) or isSuper)

    if require == OWN:
        return group != UNAUTH and (G(perm, N.isOwn) or isSuper)

    if require == COORD:
        return group == COORD and G(perm, N.sameCountry) or isSuper


def getPermField(table, permRecord, require):
    &#34;&#34;&#34;Determine read/edit permissions for a field in a record in a table.

    !!! hint
        When it comes to checking a field permission, first get the
        record permission, then the field requirements.
        Then apply this function to get the result.

    Parameters
    ----------
    table: string
        Where the record resides
    permRecord:
        Permissions based on the record as a whole.
    require:
        Permissions required for reading/editing a particular field,
        coming from the table specific .yaml files with field specifications.

    Returns
    -------
    mayRead: boolean
    mayEdit: boolean
    &#34;&#34;&#34;

    mayRead = None
    if table in ALLOW_OUR:
        mayRead = G(permRecord, N.isOur) or None
    if mayRead is None:
        readRequire = (
            G(DEFAULT_PERM, N.read)
            if require is None or N.read not in require
            else G(require, N.read)
        )
        mayRead = checkPerm(readRequire, permRecord)

    editRequire = (
        G(DEFAULT_PERM, N.edit)
        if require is None or N.edit not in require
        else G(require, N.edit)
    )
    mayEdit = checkPerm(editRequire, permRecord)
    return (mayRead, mayEdit)


def permRecord(context, table, record):
    &#34;&#34;&#34;Determine record permissions.

    Various possible relationships between this user and the record will be examined.

    Parameters
    ----------

    Returns
    -------
    group: string
        Permission group of current user
    country: ObjectId
        Country to which the record belongs. Follow the detail-master chain from the
        record to the contrib record and read the country from the contrib.
    isOwn: boolean
        Is the record created by the current user?
    isEdit: boolean
        Is the record created by the current user or is (s)he in the list of
        editors of this record?
    sameCountry: boolean
        Does the record belong to the same country as the currennt user?
    isCoordinated: boolean
        Is this record under the jurisdiction of the current user as National
        Coordinator?
    isOur: boolean
        Is this record in the workflow of the current user?
        As creator/editor/reviewer/coordinator?
    contribId: ObjectId
        The id of the contrib to which this record is linked.

    These attributes are returned as a `dict`.
    &#34;&#34;&#34;
    auth = context.auth
    user = auth.user
    uid = G(user, N._id)
    group = auth.groupRep()
    uCountry = G(user, N.country)

    cRecord = {}
    aRecord = {}

    if table == N.contrib:
        cRecord = record
    elif table == N.assessment:
        aRecord = record
        contribId = G(record, N.contrib)
        cRecord = context.getItem(N.contrib, contribId)
    elif table in {N.review, N.criteriaEntry, N.reviewEntry}:
        assessmentId = G(record, N.assessment)
        aRecord = context.getItem(N.assessment, assessmentId)
        contribId = G(aRecord, N.contrib)
        cRecord = context.getItem(N.contrib, contribId)

    refCountry = G(cRecord, N.country)
    reviewerE = G(aRecord, N.reviewerE)
    reviewerF = G(aRecord, N.reviewerF)
    reviewers = {reviewerE, reviewerF} - {None}

    sameCountry = refCountry is not None and refCountry == uCountry
    isAuth = group != UNAUTH and uid is not None
    isCreator = uid is not None and uid == G(record, N.creator)
    isEditor = uid is not None and uid in (G(record, N.editors) or set())
    isCoordinated = isAuth and sameCountry and group == COORD
    isACreator = uid is not None and uid == G(aRecord, N.creator)
    isAEditor = uid is not None and uid in (G(aRecord, N.editors) or set())
    isReviewer = uid is not None and uid in reviewers

    isOur = table in ALLOW_OUR and (
        isCoordinated
        or isCreator
        or isEditor
        or isACreator
        or isAEditor
        or isReviewer
    )

    return {
        N.group: group,
        N.country: refCountry,
        N.isOwn: isAuth and isCreator,
        N.isEdit: isAuth and (isCreator or isEditor),
        N.sameCountry: sameCountry,
        N.isCoordinated: isCoordinated,
        N.isOur: isOur,
        N.isReviewer: isReviewer,
        N.contribId: G(cRecord, N._id),
    }</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="control.perm.checkPerm"><code class="name flex">
<span>def <span class="ident">checkPerm</span></span>(<span>require, perm)</span>
</code></dt>
<dd>
<div class="desc"><p>Verify whether user's credentials match the requirements.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>require</code></strong> :&ensp;<code>string</code></dt>
<dd>The required permission level (see the perm.yaml configuration file under
the key <code>roles</code>).</dd>
<dt><strong><code>perm</code></strong> :&ensp;<code>dict</code></dt>
<dd>User attributes, in paticular <code>group</code> which is the role a user can play on the
basis of his/her identity.
But it also contains attributes that links a user to ceertain records, e.g. the
records of which (s)he is creator/editor, or National Coordinator.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>boolean</code></dt>
<dd>&nbsp;</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def checkPerm(
    require, perm,
):
    &#34;&#34;&#34;Verify whether user&#39;s credentials match the requirements.

    Parameters
    ----------
    require: string
        The required permission level (see the perm.yaml configuration file under
        the key `roles`).
    perm: dict
        User attributes, in paticular `group` which is the role a user can play on the
        basis of his/her identity.
        But it also contains attributes that links a user to ceertain records, e.g. the
        records of which (s)he is creator/editor, or National Coordinator.

    Returns
    -------
    boolean
    &#34;&#34;&#34;

    if require == UNAUTH:
        return True

    group = G(perm, N.group)

    if require == NOBODY:
        return False

    if require == AUTH:
        return group != UNAUTH

    isSuper = group in {OFFICE, SYSTEM, ROOT}

    if require == OFFICE:
        return isSuper

    if require == SYSTEM:
        return group in {SYSTEM, ROOT}

    if require == ROOT:
        return group == ROOT

    if require == EDIT:
        return group != UNAUTH and (G(perm, N.isEdit) or isSuper)

    if require == OWN:
        return group != UNAUTH and (G(perm, N.isOwn) or isSuper)

    if require == COORD:
        return group == COORD and G(perm, N.sameCountry) or isSuper</code></pre>
</details>
</dd>
<dt id="control.perm.checkTable"><code class="name flex">
<span>def <span class="ident">checkTable</span></span>(<span>auth, table)</span>
</code></dt>
<dd>
<div class="desc"><p>Verify whether user's credentials match the requirements for a table.</p>
<p>Every table can only be listed on the interface if the user has permissions
for it.
The table permissions are configured in <code>tables.yaml</code>, under the key <code>perm</code>.
For each table the minimal role is stated that can access the table.</p>
<p>If a table is not permitted, then its records are also not permitted,
neither are fields in those records.</p>
<p>However, this holds for the generic interface. Individual tables and records
and fields may be regulated in addition by
<code><a title="control.workflow.apply.WorkflowItem" href="workflow/apply.html#control.workflow.apply.WorkflowItem">WorkflowItem</a></code> conditions,
which can open up and close off material.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>auth</code></strong> :&ensp;<code>object</code></dt>
<dd>The <code><a title="control.auth.Auth" href="auth.html#control.auth.Auth">Auth</a></code> singleton, from which the group of the current
user can be obtained.</dd>
<dt><strong><code>table</code></strong> :&ensp;<code>string</code></dt>
<dd>The table for which permission is required.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>boolean</code></dt>
<dd>&nbsp;</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def checkTable(
    auth, table
):
    &#34;&#34;&#34;Verify whether user&#39;s credentials match the requirements for a table.

    Every table can only be listed on the interface if the user has permissions
    for it.
    The table permissions are configured in `tables.yaml`, under the key `perm`.
    For each table the minimal role is stated that can access the table.

    If a table is not permitted, then its records are also not permitted,
    neither are fields in those records.

    However, this holds for the generic interface. Individual tables and records
    and fields may be regulated in addition by
    `control.workflow.apply.WorkflowItem` conditions,
    which can open up and close off material.

    Parameters
    ----------
    auth: object
        The `control.auth.Auth` singleton, from which the group of the current
        user can be obtained.
    table: string
        The table for which permission is required.

    Returns
    -------
    boolean
    &#34;&#34;&#34;

    require = G(TABLE_PERM, table)
    if require is None:
        return False

    if require == UNAUTH:
        return True

    group = auth.groupRep()

    if require == NOBODY:
        return False

    if require == AUTH:
        return group != UNAUTH

    isSuper = group in {OFFICE, SYSTEM, ROOT}

    if require == OFFICE:
        return isSuper

    if require == SYSTEM:
        return group in {SYSTEM, ROOT}

    if require == ROOT:
        return group == ROOT

    if require == COORD:
        return group == COORD or isSuper</code></pre>
</details>
</dd>
<dt id="control.perm.getPermField"><code class="name flex">
<span>def <span class="ident">getPermField</span></span>(<span>table, permRecord, require)</span>
</code></dt>
<dd>
<div class="desc"><p>Determine read/edit permissions for a field in a record in a table.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>When it comes to checking a field permission, first get the
record permission, then the field requirements.
Then apply this function to get the result.</p>
</div>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>table</code></strong> :&ensp;<code>string</code></dt>
<dd>Where the record resides</dd>
</dl>
<p>permRecord:
Permissions based on the record as a whole.
require:
Permissions required for reading/editing a particular field,
coming from the table specific .yaml files with field specifications.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>mayRead</code></strong> :&ensp;<code>boolean</code></dt>
<dd>&nbsp;</dd>
<dt><strong><code>mayEdit</code></strong> :&ensp;<code>boolean</code></dt>
<dd>&nbsp;</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getPermField(table, permRecord, require):
    &#34;&#34;&#34;Determine read/edit permissions for a field in a record in a table.

    !!! hint
        When it comes to checking a field permission, first get the
        record permission, then the field requirements.
        Then apply this function to get the result.

    Parameters
    ----------
    table: string
        Where the record resides
    permRecord:
        Permissions based on the record as a whole.
    require:
        Permissions required for reading/editing a particular field,
        coming from the table specific .yaml files with field specifications.

    Returns
    -------
    mayRead: boolean
    mayEdit: boolean
    &#34;&#34;&#34;

    mayRead = None
    if table in ALLOW_OUR:
        mayRead = G(permRecord, N.isOur) or None
    if mayRead is None:
        readRequire = (
            G(DEFAULT_PERM, N.read)
            if require is None or N.read not in require
            else G(require, N.read)
        )
        mayRead = checkPerm(readRequire, permRecord)

    editRequire = (
        G(DEFAULT_PERM, N.edit)
        if require is None or N.edit not in require
        else G(require, N.edit)
    )
    mayEdit = checkPerm(editRequire, permRecord)
    return (mayRead, mayEdit)</code></pre>
</details>
</dd>
<dt id="control.perm.permRecord"><code class="name flex">
<span>def <span class="ident">permRecord</span></span>(<span>context, table, record)</span>
</code></dt>
<dd>
<div class="desc"><p>Determine record permissions.</p>
<p>Various possible relationships between this user and the record will be examined.</p>
<h2 id="parameters">Parameters</h2>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>group</code></strong> :&ensp;<code>string</code></dt>
<dd>Permission group of current user</dd>
<dt><strong><code>country</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>Country to which the record belongs. Follow the detail-master chain from the
record to the contrib record and read the country from the contrib.</dd>
<dt><strong><code>isOwn</code></strong> :&ensp;<code>boolean</code></dt>
<dd>Is the record created by the current user?</dd>
<dt><strong><code>isEdit</code></strong> :&ensp;<code>boolean</code></dt>
<dd>Is the record created by the current user or is (s)he in the list of
editors of this record?</dd>
<dt><strong><code>sameCountry</code></strong> :&ensp;<code>boolean</code></dt>
<dd>Does the record belong to the same country as the currennt user?</dd>
<dt><strong><code>isCoordinated</code></strong> :&ensp;<code>boolean</code></dt>
<dd>Is this record under the jurisdiction of the current user as National
Coordinator?</dd>
<dt><strong><code>isOur</code></strong> :&ensp;<code>boolean</code></dt>
<dd>Is this record in the workflow of the current user?
As creator/editor/reviewer/coordinator?</dd>
<dt><strong><code>contribId</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>The id of the contrib to which this record is linked.</dd>
</dl>
<p>These attributes are returned as a <code>dict</code>.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def permRecord(context, table, record):
    &#34;&#34;&#34;Determine record permissions.

    Various possible relationships between this user and the record will be examined.

    Parameters
    ----------

    Returns
    -------
    group: string
        Permission group of current user
    country: ObjectId
        Country to which the record belongs. Follow the detail-master chain from the
        record to the contrib record and read the country from the contrib.
    isOwn: boolean
        Is the record created by the current user?
    isEdit: boolean
        Is the record created by the current user or is (s)he in the list of
        editors of this record?
    sameCountry: boolean
        Does the record belong to the same country as the currennt user?
    isCoordinated: boolean
        Is this record under the jurisdiction of the current user as National
        Coordinator?
    isOur: boolean
        Is this record in the workflow of the current user?
        As creator/editor/reviewer/coordinator?
    contribId: ObjectId
        The id of the contrib to which this record is linked.

    These attributes are returned as a `dict`.
    &#34;&#34;&#34;
    auth = context.auth
    user = auth.user
    uid = G(user, N._id)
    group = auth.groupRep()
    uCountry = G(user, N.country)

    cRecord = {}
    aRecord = {}

    if table == N.contrib:
        cRecord = record
    elif table == N.assessment:
        aRecord = record
        contribId = G(record, N.contrib)
        cRecord = context.getItem(N.contrib, contribId)
    elif table in {N.review, N.criteriaEntry, N.reviewEntry}:
        assessmentId = G(record, N.assessment)
        aRecord = context.getItem(N.assessment, assessmentId)
        contribId = G(aRecord, N.contrib)
        cRecord = context.getItem(N.contrib, contribId)

    refCountry = G(cRecord, N.country)
    reviewerE = G(aRecord, N.reviewerE)
    reviewerF = G(aRecord, N.reviewerF)
    reviewers = {reviewerE, reviewerF} - {None}

    sameCountry = refCountry is not None and refCountry == uCountry
    isAuth = group != UNAUTH and uid is not None
    isCreator = uid is not None and uid == G(record, N.creator)
    isEditor = uid is not None and uid in (G(record, N.editors) or set())
    isCoordinated = isAuth and sameCountry and group == COORD
    isACreator = uid is not None and uid == G(aRecord, N.creator)
    isAEditor = uid is not None and uid in (G(aRecord, N.editors) or set())
    isReviewer = uid is not None and uid in reviewers

    isOur = table in ALLOW_OUR and (
        isCoordinated
        or isCreator
        or isEditor
        or isACreator
        or isAEditor
        or isReviewer
    )

    return {
        N.group: group,
        N.country: refCountry,
        N.isOwn: isAuth and isCreator,
        N.isEdit: isAuth and (isCreator or isEditor),
        N.sameCountry: sameCountry,
        N.isCoordinated: isCoordinated,
        N.isOur: isOur,
        N.isReviewer: isReviewer,
        N.contribId: G(cRecord, N._id),
    }</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="control" href="index.html">control</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="control.perm.checkPerm" href="#control.perm.checkPerm">checkPerm</a></code></li>
<li><code><a title="control.perm.checkTable" href="#control.perm.checkTable">checkTable</a></code></li>
<li><code><a title="control.perm.getPermField" href="#control.perm.getPermField">getPermField</a></code></li>
<li><code><a title="control.perm.permRecord" href="#control.perm.permRecord">permRecord</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>