<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>control.details API documentation</title>
<meta name="description" content="Detail records of master records of tables â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>control.details</code></h1>
</header>
<section id="section-intro">
<p>Detail records of master records of tables.</p>
<ul>
<li>Rendering</li>
<li>Customization</li>
</ul>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Detail records of master records of tables.

*   Rendering
*   Customization
&#34;&#34;&#34;

from config import Config as C, Names as N
from control.utils import pick as G, E
from control.html import HtmlElements as H
from control.perm import checkTable

CT = C.tables

DETAILS = CT.details


class Details:
    &#34;&#34;&#34;Deals with detail records.&#34;&#34;&#34;

    inheritProps = (
        N.context,
        N.uid,
        N.eppn,
        N.tableObj,
        N.mkTable,
        N.table,
        N.record,
        N.eid,
        N.fields,
        N.prov,
        N.perm,
        N.wfitem,
        N.kind,
    )

    def __init__(self, recordObj):
        &#34;&#34;&#34;## Initialization

        Store the incoming information.

        A number of properties will be inherited from the master record object
        that spawns a detail record object.

        Parameters
        ----------
        recordObj: object
            A `control.record.Record` object (or one of a derived class)
        &#34;&#34;&#34;

        for prop in Details.inheritProps:
            setattr(self, prop, getattr(recordObj, prop, None))

        self.details = {}
        &#34;&#34;&#34;*dict* Stores the details of this record.

        Keyed by the name of the detail table, values  are lists of detail
        records in that detail table.
        &#34;&#34;&#34;

    def tablePerm(self, table):
        context = self.context
        auth = context.auth

        return checkTable(auth, table)

    def fetchDetails(self, dtable, sortKey=None):
        &#34;&#34;&#34;Fetch detail records from the database.

        !!! caution
            The details will only be fetched if the user has permissions
            to list the detail table!

        !!! caution &#34;Workflow restrictions&#34;
            There might be additional restrictions on individual records
            due to workflow. Some records may not be readable.
            They will be filtered out.

        Parameters
        ----------
        dtable: string
            The name of the table in which the detail records are stored.
        sortKey: function
            A function to sort the detail records.

        Returns
        -------
        void
            The detail records are stored in the `details` attribute, which is a
            dict keyed by the names of the detail tables.
        &#34;&#34;&#34;

        if not self.tablePerm(dtable):
            return

        context = self.context
        db = context.db
        mkTable = self.mkTable
        table = self.table
        eid = self.eid

        dtableObj = mkTable(context, dtable)
        drecords = db.getDetails(dtable, table, eid, sortKey=sortKey)
        self.details[dtable] = (
            dtableObj,
            tuple(drecord for drecord in drecords if dtableObj.readable(drecord)),
        )

    def wrap(self, readonly=False, showTable=None, showEid=None):
        &#34;&#34;&#34;Wrap the details of all tables for this record into HTML.

        Parameters
        ----------
        readonly: boolean, optional `False`
            Whether the records should be presented in readonly form.
        showTable: string
            Name of the detail table of which record `showEid` should be opened.
        showEid: ObjectId
            Id of the detail record that should be initially opened.

        Returns
        -------
        string(html)
        &#34;&#34;&#34;

        table = self.table

        for detailTable in G(DETAILS, table, default=[]):
            self.fetchDetails(detailTable)

        details = self.details

        return H.join(
            self.wrapDetail(
                detailTable,
                readonly=readonly,
                showEid=showEid if detailTable == showTable else None,
            )
            for detailTable in details
        )

    def wrapDetail(
        self,
        dtable,
        withDetails=False,
        readonly=False,
        bodyMethod=None,
        inner=True,
        wrapMethod=None,
        expanded=False,
        withProv=True,
        extraCls=None,
        filterFunc=None,
        combineMethod=None,
        withN=True,
        showEid=None,
    ):
        &#34;&#34;&#34;Wrap the details of a specific table for this record into HTML.

        Some of the parameters above will be passed to the initializers
        of the detail record objects, others to their `wrap` method.

        Parameters
        ----------
        dtable: string
            The name of the detail table
        withDetails, readonly, bodyMethod: mixed
            See `control.record.Record`
        inner, wrapMethod, withProv, extraCls: mixed
            See `control.record.Record.wrap`.
        expanded: boolean
            Whether to expand all details in this detail table.
            If True, the expanded details will not get a collapse control.
        filterFunc: function, optional `None`
            You can optionally filter the detail records.
        combineMethod: function, optional `None`
            After getting the HTML for individual records, you can
            instruct to reorder/restructure those representations.
        withN: boolean, optional `True`
            Whether to present the number of detail records
        showEid: ObjectId
            Id of the detail record that should be initially opened.

        Returns
        -------
        string(html)
        &#34;&#34;&#34;

        details = self.details

        (dtableObj, drecordsAll) = G(details, dtable, default=(None, []))
        if not dtableObj:
            return E

        drecords = [
            drecord
            for drecord in drecordsAll
            if filterFunc is None or filterFunc(drecord)
        ]

        nRecords = len(drecords)
        if nRecords == 0:
            return E

        (itemSingular, itemPlural) = dtableObj.itemLabels
        itemLabel = itemSingular if nRecords == 1 else itemPlural

        nRep = H.div(f&#34;&#34;&#34;{nRecords} {itemLabel}&#34;&#34;&#34;, cls=&#34;stats&#34;)

        drecordReps = []
        for drecord in drecords:
            show = showEid == str(G(drecord, N._id))
            drecordReps.append(
                dtableObj.record(
                    record=drecord,
                    readonly=readonly,
                    bodyMethod=bodyMethod,
                    withDetails=withDetails or show,
                ).wrap(
                    inner=inner,
                    wrapMethod=wrapMethod,
                    withProv=withProv,
                    expanded=0 if expanded else 1 if show else -1,
                )
            )
        if combineMethod:
            drecordReps = combineMethod(drecordReps)

        innerCls = &#34; inner&#34; if inner else E
        return H.div(
            [nRep if withN else E] + drecordReps,
            cls=f&#34;record-details{innerCls} {extraCls}&#34;,
        )

    @staticmethod
    def mustShow(table, kwargs):
        &#34;&#34;&#34;Determines the record id specified by `showTable` and `showEid` in `kwargs`.

        &#34;kwargs&#34; may contain the keys `showTable` and `showEid`.
        We want the value of `showEid`, but only if the value of `showTable` matches
        `table`.

        !!! hint
            We need this when we have just inserted a detail record and want to
            navigate to the master record with the new detail record in an
            expanded state.
        &#34;&#34;&#34;

        return G(kwargs, N.showEid) if G(kwargs, N.showTable) == table else None</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="control.details.Details"><code class="flex name class">
<span>class <span class="ident">Details</span></span>
<span>(</span><span>recordObj)</span>
</code></dt>
<dd>
<div class="desc"><p>Deals with detail records.</p>
<h2 id="initialization">Initialization</h2>
<p>Store the incoming information.</p>
<p>A number of properties will be inherited from the master record object
that spawns a detail record object.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>recordObj</code></strong> :&ensp;<code>object</code></dt>
<dd>A <code><a title="control.record.Record" href="record.html#control.record.Record">Record</a></code> object (or one of a derived class)</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Details:
    &#34;&#34;&#34;Deals with detail records.&#34;&#34;&#34;

    inheritProps = (
        N.context,
        N.uid,
        N.eppn,
        N.tableObj,
        N.mkTable,
        N.table,
        N.record,
        N.eid,
        N.fields,
        N.prov,
        N.perm,
        N.wfitem,
        N.kind,
    )

    def __init__(self, recordObj):
        &#34;&#34;&#34;## Initialization

        Store the incoming information.

        A number of properties will be inherited from the master record object
        that spawns a detail record object.

        Parameters
        ----------
        recordObj: object
            A `control.record.Record` object (or one of a derived class)
        &#34;&#34;&#34;

        for prop in Details.inheritProps:
            setattr(self, prop, getattr(recordObj, prop, None))

        self.details = {}
        &#34;&#34;&#34;*dict* Stores the details of this record.

        Keyed by the name of the detail table, values  are lists of detail
        records in that detail table.
        &#34;&#34;&#34;

    def tablePerm(self, table):
        context = self.context
        auth = context.auth

        return checkTable(auth, table)

    def fetchDetails(self, dtable, sortKey=None):
        &#34;&#34;&#34;Fetch detail records from the database.

        !!! caution
            The details will only be fetched if the user has permissions
            to list the detail table!

        !!! caution &#34;Workflow restrictions&#34;
            There might be additional restrictions on individual records
            due to workflow. Some records may not be readable.
            They will be filtered out.

        Parameters
        ----------
        dtable: string
            The name of the table in which the detail records are stored.
        sortKey: function
            A function to sort the detail records.

        Returns
        -------
        void
            The detail records are stored in the `details` attribute, which is a
            dict keyed by the names of the detail tables.
        &#34;&#34;&#34;

        if not self.tablePerm(dtable):
            return

        context = self.context
        db = context.db
        mkTable = self.mkTable
        table = self.table
        eid = self.eid

        dtableObj = mkTable(context, dtable)
        drecords = db.getDetails(dtable, table, eid, sortKey=sortKey)
        self.details[dtable] = (
            dtableObj,
            tuple(drecord for drecord in drecords if dtableObj.readable(drecord)),
        )

    def wrap(self, readonly=False, showTable=None, showEid=None):
        &#34;&#34;&#34;Wrap the details of all tables for this record into HTML.

        Parameters
        ----------
        readonly: boolean, optional `False`
            Whether the records should be presented in readonly form.
        showTable: string
            Name of the detail table of which record `showEid` should be opened.
        showEid: ObjectId
            Id of the detail record that should be initially opened.

        Returns
        -------
        string(html)
        &#34;&#34;&#34;

        table = self.table

        for detailTable in G(DETAILS, table, default=[]):
            self.fetchDetails(detailTable)

        details = self.details

        return H.join(
            self.wrapDetail(
                detailTable,
                readonly=readonly,
                showEid=showEid if detailTable == showTable else None,
            )
            for detailTable in details
        )

    def wrapDetail(
        self,
        dtable,
        withDetails=False,
        readonly=False,
        bodyMethod=None,
        inner=True,
        wrapMethod=None,
        expanded=False,
        withProv=True,
        extraCls=None,
        filterFunc=None,
        combineMethod=None,
        withN=True,
        showEid=None,
    ):
        &#34;&#34;&#34;Wrap the details of a specific table for this record into HTML.

        Some of the parameters above will be passed to the initializers
        of the detail record objects, others to their `wrap` method.

        Parameters
        ----------
        dtable: string
            The name of the detail table
        withDetails, readonly, bodyMethod: mixed
            See `control.record.Record`
        inner, wrapMethod, withProv, extraCls: mixed
            See `control.record.Record.wrap`.
        expanded: boolean
            Whether to expand all details in this detail table.
            If True, the expanded details will not get a collapse control.
        filterFunc: function, optional `None`
            You can optionally filter the detail records.
        combineMethod: function, optional `None`
            After getting the HTML for individual records, you can
            instruct to reorder/restructure those representations.
        withN: boolean, optional `True`
            Whether to present the number of detail records
        showEid: ObjectId
            Id of the detail record that should be initially opened.

        Returns
        -------
        string(html)
        &#34;&#34;&#34;

        details = self.details

        (dtableObj, drecordsAll) = G(details, dtable, default=(None, []))
        if not dtableObj:
            return E

        drecords = [
            drecord
            for drecord in drecordsAll
            if filterFunc is None or filterFunc(drecord)
        ]

        nRecords = len(drecords)
        if nRecords == 0:
            return E

        (itemSingular, itemPlural) = dtableObj.itemLabels
        itemLabel = itemSingular if nRecords == 1 else itemPlural

        nRep = H.div(f&#34;&#34;&#34;{nRecords} {itemLabel}&#34;&#34;&#34;, cls=&#34;stats&#34;)

        drecordReps = []
        for drecord in drecords:
            show = showEid == str(G(drecord, N._id))
            drecordReps.append(
                dtableObj.record(
                    record=drecord,
                    readonly=readonly,
                    bodyMethod=bodyMethod,
                    withDetails=withDetails or show,
                ).wrap(
                    inner=inner,
                    wrapMethod=wrapMethod,
                    withProv=withProv,
                    expanded=0 if expanded else 1 if show else -1,
                )
            )
        if combineMethod:
            drecordReps = combineMethod(drecordReps)

        innerCls = &#34; inner&#34; if inner else E
        return H.div(
            [nRep if withN else E] + drecordReps,
            cls=f&#34;record-details{innerCls} {extraCls}&#34;,
        )

    @staticmethod
    def mustShow(table, kwargs):
        &#34;&#34;&#34;Determines the record id specified by `showTable` and `showEid` in `kwargs`.

        &#34;kwargs&#34; may contain the keys `showTable` and `showEid`.
        We want the value of `showEid`, but only if the value of `showTable` matches
        `table`.

        !!! hint
            We need this when we have just inserted a detail record and want to
            navigate to the master record with the new detail record in an
            expanded state.
        &#34;&#34;&#34;

        return G(kwargs, N.showEid) if G(kwargs, N.showTable) == table else None</code></pre>
</details>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="control.cust.assessment_details.AssessmentD" href="cust/assessment_details.html#control.cust.assessment_details.AssessmentD">AssessmentD</a></li>
<li><a title="control.cust.contrib_details.ContribD" href="cust/contrib_details.html#control.cust.contrib_details.ContribD">ContribD</a></li>
<li><a title="control.cust.criteriaentry_details.CriteriaEntryD" href="cust/criteriaentry_details.html#control.cust.criteriaentry_details.CriteriaEntryD">CriteriaEntryD</a></li>
<li><a title="control.cust.review_details.ReviewD" href="cust/review_details.html#control.cust.review_details.ReviewD">ReviewD</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="control.details.Details.inheritProps"><code class="name">var <span class="ident">inheritProps</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Static methods</h3>
<dl>
<dt id="control.details.Details.mustShow"><code class="name flex">
<span>def <span class="ident">mustShow</span></span>(<span>table, kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Determines the record id specified by <code>showTable</code> and <code>showEid</code> in <code>kwargs</code>.</p>
<p>"kwargs" may contain the keys <code>showTable</code> and <code>showEid</code>.
We want the value of <code>showEid</code>, but only if the value of <code>showTable</code> matches
<code>table</code>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>We need this when we have just inserted a detail record and want to
navigate to the master record with the new detail record in an
expanded state.</p>
</div></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def mustShow(table, kwargs):
    &#34;&#34;&#34;Determines the record id specified by `showTable` and `showEid` in `kwargs`.

    &#34;kwargs&#34; may contain the keys `showTable` and `showEid`.
    We want the value of `showEid`, but only if the value of `showTable` matches
    `table`.

    !!! hint
        We need this when we have just inserted a detail record and want to
        navigate to the master record with the new detail record in an
        expanded state.
    &#34;&#34;&#34;

    return G(kwargs, N.showEid) if G(kwargs, N.showTable) == table else None</code></pre>
</details>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="control.details.Details.details"><code class="name">var <span class="ident">details</span></code></dt>
<dd>
<div class="desc"><p><em>dict</em> Stores the details of this record.</p>
<p>Keyed by the name of the detail table, values
are lists of detail
records in that detail table.</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="control.details.Details.fetchDetails"><code class="name flex">
<span>def <span class="ident">fetchDetails</span></span>(<span>self, dtable, sortKey=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Fetch detail records from the database.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The details will only be fetched if the user has permissions
to list the detail table!</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Workflow restrictions</p>
<p>There might be additional restrictions on individual records
due to workflow. Some records may not be readable.
They will be filtered out.</p>
</div>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>dtable</code></strong> :&ensp;<code>string</code></dt>
<dd>The name of the table in which the detail records are stored.</dd>
<dt><strong><code>sortKey</code></strong> :&ensp;<code>function</code></dt>
<dd>A function to sort the detail records.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>void</code></dt>
<dd>The detail records are stored in the <code>details</code> attribute, which is a
dict keyed by the names of the detail tables.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def fetchDetails(self, dtable, sortKey=None):
    &#34;&#34;&#34;Fetch detail records from the database.

    !!! caution
        The details will only be fetched if the user has permissions
        to list the detail table!

    !!! caution &#34;Workflow restrictions&#34;
        There might be additional restrictions on individual records
        due to workflow. Some records may not be readable.
        They will be filtered out.

    Parameters
    ----------
    dtable: string
        The name of the table in which the detail records are stored.
    sortKey: function
        A function to sort the detail records.

    Returns
    -------
    void
        The detail records are stored in the `details` attribute, which is a
        dict keyed by the names of the detail tables.
    &#34;&#34;&#34;

    if not self.tablePerm(dtable):
        return

    context = self.context
    db = context.db
    mkTable = self.mkTable
    table = self.table
    eid = self.eid

    dtableObj = mkTable(context, dtable)
    drecords = db.getDetails(dtable, table, eid, sortKey=sortKey)
    self.details[dtable] = (
        dtableObj,
        tuple(drecord for drecord in drecords if dtableObj.readable(drecord)),
    )</code></pre>
</details>
</dd>
<dt id="control.details.Details.tablePerm"><code class="name flex">
<span>def <span class="ident">tablePerm</span></span>(<span>self, table)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def tablePerm(self, table):
    context = self.context
    auth = context.auth

    return checkTable(auth, table)</code></pre>
</details>
</dd>
<dt id="control.details.Details.wrap"><code class="name flex">
<span>def <span class="ident">wrap</span></span>(<span>self, readonly=False, showTable=None, showEid=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Wrap the details of all tables for this record into HTML.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>readonly</code></strong> :&ensp;<code>boolean</code>, optional <code>False</code></dt>
<dd>Whether the records should be presented in readonly form.</dd>
<dt><strong><code>showTable</code></strong> :&ensp;<code>string</code></dt>
<dd>Name of the detail table of which record <code>showEid</code> should be opened.</dd>
<dt><strong><code>showEid</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>Id of the detail record that should be initially opened.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>string(html)</code></dt>
<dd>&nbsp;</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def wrap(self, readonly=False, showTable=None, showEid=None):
    &#34;&#34;&#34;Wrap the details of all tables for this record into HTML.

    Parameters
    ----------
    readonly: boolean, optional `False`
        Whether the records should be presented in readonly form.
    showTable: string
        Name of the detail table of which record `showEid` should be opened.
    showEid: ObjectId
        Id of the detail record that should be initially opened.

    Returns
    -------
    string(html)
    &#34;&#34;&#34;

    table = self.table

    for detailTable in G(DETAILS, table, default=[]):
        self.fetchDetails(detailTable)

    details = self.details

    return H.join(
        self.wrapDetail(
            detailTable,
            readonly=readonly,
            showEid=showEid if detailTable == showTable else None,
        )
        for detailTable in details
    )</code></pre>
</details>
</dd>
<dt id="control.details.Details.wrapDetail"><code class="name flex">
<span>def <span class="ident">wrapDetail</span></span>(<span>self, dtable, withDetails=False, readonly=False, bodyMethod=None, inner=True, wrapMethod=None, expanded=False, withProv=True, extraCls=None, filterFunc=None, combineMethod=None, withN=True, showEid=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Wrap the details of a specific table for this record into HTML.</p>
<p>Some of the parameters above will be passed to the initializers
of the detail record objects, others to their <code>wrap</code> method.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>dtable</code></strong> :&ensp;<code>string</code></dt>
<dd>The name of the detail table</dd>
<dt><strong><code>withDetails</code></strong>, <strong><code>readonly</code></strong>, <strong><code>bodyMethod</code></strong> :&ensp;<code>mixed</code></dt>
<dd>See <code><a title="control.record.Record" href="record.html#control.record.Record">Record</a></code></dd>
<dt><strong><code>inner</code></strong>, <strong><code>wrapMethod</code></strong>, <strong><code>withProv</code></strong>, <strong><code>extraCls</code></strong> :&ensp;<code>mixed</code></dt>
<dd>See <code><a title="control.record.Record.wrap" href="record.html#control.record.Record.wrap">Record.wrap()</a></code>.</dd>
<dt><strong><code>expanded</code></strong> :&ensp;<code>boolean</code></dt>
<dd>Whether to expand all details in this detail table.
If True, the expanded details will not get a collapse control.</dd>
<dt><strong><code>filterFunc</code></strong> :&ensp;<code>function</code>, optional <code>None</code></dt>
<dd>You can optionally filter the detail records.</dd>
<dt><strong><code>combineMethod</code></strong> :&ensp;<code>function</code>, optional <code>None</code></dt>
<dd>After getting the HTML for individual records, you can
instruct to reorder/restructure those representations.</dd>
<dt><strong><code>withN</code></strong> :&ensp;<code>boolean</code>, optional <code>True</code></dt>
<dd>Whether to present the number of detail records</dd>
<dt><strong><code>showEid</code></strong> :&ensp;<code>ObjectId</code></dt>
<dd>Id of the detail record that should be initially opened.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>string(html)</code></dt>
<dd>&nbsp;</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def wrapDetail(
    self,
    dtable,
    withDetails=False,
    readonly=False,
    bodyMethod=None,
    inner=True,
    wrapMethod=None,
    expanded=False,
    withProv=True,
    extraCls=None,
    filterFunc=None,
    combineMethod=None,
    withN=True,
    showEid=None,
):
    &#34;&#34;&#34;Wrap the details of a specific table for this record into HTML.

    Some of the parameters above will be passed to the initializers
    of the detail record objects, others to their `wrap` method.

    Parameters
    ----------
    dtable: string
        The name of the detail table
    withDetails, readonly, bodyMethod: mixed
        See `control.record.Record`
    inner, wrapMethod, withProv, extraCls: mixed
        See `control.record.Record.wrap`.
    expanded: boolean
        Whether to expand all details in this detail table.
        If True, the expanded details will not get a collapse control.
    filterFunc: function, optional `None`
        You can optionally filter the detail records.
    combineMethod: function, optional `None`
        After getting the HTML for individual records, you can
        instruct to reorder/restructure those representations.
    withN: boolean, optional `True`
        Whether to present the number of detail records
    showEid: ObjectId
        Id of the detail record that should be initially opened.

    Returns
    -------
    string(html)
    &#34;&#34;&#34;

    details = self.details

    (dtableObj, drecordsAll) = G(details, dtable, default=(None, []))
    if not dtableObj:
        return E

    drecords = [
        drecord
        for drecord in drecordsAll
        if filterFunc is None or filterFunc(drecord)
    ]

    nRecords = len(drecords)
    if nRecords == 0:
        return E

    (itemSingular, itemPlural) = dtableObj.itemLabels
    itemLabel = itemSingular if nRecords == 1 else itemPlural

    nRep = H.div(f&#34;&#34;&#34;{nRecords} {itemLabel}&#34;&#34;&#34;, cls=&#34;stats&#34;)

    drecordReps = []
    for drecord in drecords:
        show = showEid == str(G(drecord, N._id))
        drecordReps.append(
            dtableObj.record(
                record=drecord,
                readonly=readonly,
                bodyMethod=bodyMethod,
                withDetails=withDetails or show,
            ).wrap(
                inner=inner,
                wrapMethod=wrapMethod,
                withProv=withProv,
                expanded=0 if expanded else 1 if show else -1,
            )
        )
    if combineMethod:
        drecordReps = combineMethod(drecordReps)

    innerCls = &#34; inner&#34; if inner else E
    return H.div(
        [nRep if withN else E] + drecordReps,
        cls=f&#34;record-details{innerCls} {extraCls}&#34;,
    )</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="control" href="index.html">control</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="control.details.Details" href="#control.details.Details">Details</a></code></h4>
<ul class="two-column">
<li><code><a title="control.details.Details.details" href="#control.details.Details.details">details</a></code></li>
<li><code><a title="control.details.Details.fetchDetails" href="#control.details.Details.fetchDetails">fetchDetails</a></code></li>
<li><code><a title="control.details.Details.inheritProps" href="#control.details.Details.inheritProps">inheritProps</a></code></li>
<li><code><a title="control.details.Details.mustShow" href="#control.details.Details.mustShow">mustShow</a></code></li>
<li><code><a title="control.details.Details.tablePerm" href="#control.details.Details.tablePerm">tablePerm</a></code></li>
<li><code><a title="control.details.Details.wrap" href="#control.details.Details.wrap">wrap</a></code></li>
<li><code><a title="control.details.Details.wrapDetail" href="#control.details.Details.wrapDetail">wrapDetail</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>