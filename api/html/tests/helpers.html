<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.2" />
<title>helpers API documentation</title>
<meta name="description" content="Helpers to factor our massively redundant test code." />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>helpers</code></h1>
</header>
<section id="section-intro">
<p>Helpers to factor our massively redundant test code.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Helpers to factor our massively redundant test code.
&#34;&#34;&#34;

import re

from flask import json


fieldRe = re.compile(&#34;&#34;&#34;&lt;!-- ([^=]+)=(.*?) --&gt;&#34;&#34;&#34;, re.S)
msgRe = re.compile(&#34;&#34;&#34;&lt;div class=&#34;msgitem.*?&gt;(.*?)&lt;/div&gt;&#34;&#34;&#34;, re.S)
eidRe = re.compile(&#34;&#34;&#34;&lt;details itemkey=[&#39;&#34;]contrib/([^&#39;&#34;]*)[&#39;&#34;]&#34;&#34;&#34;, re.S)
userRe = re.compile(
    &#34;&#34;&#34;&lt;details itemkey=[&#39;&#34;]user/([^&#39;&#34;]*)[&#39;&#34;].*?&lt;summary&gt;.*?&lt;span.*?&gt;([^&lt;]*)&lt;/span&gt;&#34;&#34;&#34;,
    re.S,
)
valueRe = re.compile(&#34;&#34;&#34;eid=[&#39;&#34;](.*?)[&#39;&#34;][^&gt;]*&gt;(.*?)(?:&amp;#xa;)?&lt;&#34;&#34;&#34;, re.S)


def fieldEditRe(eid, field):
    return re.compile(
        r&#34;&#34;&#34;
    &lt;span\ [^&gt;]*?eid=[&#39;&#34;]{eid}[&#39;&#34;]\s+field=[&#39;&#34;]{field}[&#39;&#34;].*?
    &lt;div\ wtype=[&#39;&#34;]related[&#39;&#34;]\ .*?
    &lt;div\ class=[&#39;&#34;]wvalue[&#39;&#34;]&gt;(.*?)&lt;/div&gt;
    &#34;&#34;&#34;.format(
            eid=eid, field=field
        ),
        re.S | re.X,
    )


def makeClient(app, eppn):
    &#34;&#34;&#34;Logs in a specific user.

    Parameters
    ----------
    app: object
    eppn: string
        Identity of the user
    &#34;&#34;&#34;

    client = app.test_client()
    response = client.get(f&#34;/login?eppn={eppn}&#34;)
    if response.status_code == 302:
        return client
    return None


def isStatus(client, url, status):
    &#34;&#34;&#34;Get data and see whether that went right or wrong.

    Parameters
    ----------
    client: function
    url: string(url)
        The url to retrieve from the server
    status: boolean
        Whether it is expected to be successful
    &#34;&#34;&#34;

    response = client.get(url)
    if status:
        assert response.status_code == 302
    else:
        assert response.status_code == 303


def isWrong(client, url):
    &#34;&#34;&#34;Get data and see whether that went wrong.

    Parameters
    ----------
    client: function
    url: string(url)
        The url to retrieve from the server
    &#34;&#34;&#34;

    return isStatus(client, url, False)


def isRight(client, url):
    &#34;&#34;&#34;Get data and see whether that went right.

    Parameters
    ----------
    client: function
    url: string(url)
        The url to retrieve from the server
    &#34;&#34;&#34;

    return isStatus(client, url, True)


def findMsg(text):
    &#34;&#34;&#34;Get flashed messages from a response.

    Parameters
    ----------
    text: string
        The response text.

    Returns
    -------
    set
        All text messages found in the flash bar.
    &#34;&#34;&#34;

    return set(msgRe.findall(text))


def findEid(text):
    &#34;&#34;&#34;Get the entity id from a response.

    If the response shows a record, dig out its entity id.

    Parameters
    ----------
    text: string
        The response text.

    Returns
    -------
    string(ObjectId)
    &#34;&#34;&#34;

    return eidRe.findall(text)[0]


def findFields(text):
    &#34;&#34;&#34;Get the fields from a response.

    If the response shows a record, dig out its fields and values.

    !!! hint
        They are neatly packaged in comment lines!

    Parameters
    ----------
    text: string
        The response text.

    Returns
    -------
    dict
        Keyed by field names, valued by field values.
    &#34;&#34;&#34;

    return {field: value for (field, value) in fieldRe.findall(text)}


def findUsers(text):
    return {
        name.split()[0].lower(): (eid, name) for (eid, name) in userRe.findall(text)
    }


def addContrib(client):
    &#34;&#34;&#34;Adds a contribution on behalf of an authenticated user.

    The response texts will be analysed into messages and fields, the eid
    of the new contribution will be read off.

    Returns
    -------
    text: string
        The complete response text
    fields: dict
        All fields and their values
    msgs: list
        All entries that have been flashed (and arrived in the flash bar)
    eid: str(ObjectId)
        The id of the inserted contribution.
    &#34;&#34;&#34;

    response = client.get(f&#34;/api/contrib/insert&#34;, follow_redirects=True)
    text = response.get_data(as_text=True)
    fields = {field: value for (field, value) in fieldRe.findall(text)}
    msgs = findMsg(text)
    eid = findEid(text)
    assert &#34;item added&#34; in msgs
    return (text, fields, msgs, eid)


def findContrib(client):
    &#34;&#34;&#34;Looks up a contribution.

    The response texts will be analysed into messages and fields, the eid
    of the new contribution will be read off.

    We assume that there is still only one contribution in the database.

    Returns
    -------
    text: string
        The complete response text
    fields: dict
        All fields and their values
    msgs: list
        All entries that have been flashed (and arrived in the flash bar)
    eid: str(ObjectId)
        The id of the inserted contribution.
    &#34;&#34;&#34;

    response = client.get(f&#34;/contrib/list&#34;)
    text = response.get_data(as_text=True)
    fields = {field: value for (field, value) in fieldRe.findall(text)}
    msgs = findMsg(text)
    eid = findEid(text)
    return (text, fields, msgs, eid)


def postJson(client, url, value):
    &#34;&#34;&#34;Post data to a url and retrieve the response text.

    Parameters
    ----------
    client: function
    url: string(url)
    value: mixed
        The value to post.
        Will be wrapped into JSON with a proper header.

    Returns
    -------
    string
        The response text
    &#34;&#34;&#34;

    response = client.post(
        url, data=json.dumps(dict(save=value)), content_type=&#34;application/json&#34;,
    )
    text = response.get_data(as_text=True)

    return text


def modifyField(client, table, eid, field, newValue):
    &#34;&#34;&#34;Post data to update a field and analyse the response for the effect.&#34;&#34;&#34;

    text = postJson(
        client, f&#34;/api/{table}/item/{eid}/field/{field}?action=view&#34;, newValue
    )
    fields = findFields(text)
    return (text, fields)


def viewField(client, table, eid, field):
    &#34;&#34;&#34;Get the response for showing a field.&#34;&#34;&#34;

    url = f&#34;/api/{table}/item/{eid}/field/{field}?action=view&#34;
    print(&#34;URL&#34;, url)
    response = client.get(url)
    print(&#34;RESPONSE&#34;, response)
    text = response.get_data(as_text=True)
    fields = findFields(text)
    return (text, fields)


def getRelatedValues(client, eid, field):
    &#34;&#34;&#34;Get an editable view on a field that represents a related value.&#34;&#34;

    We check the contents.

    &#34;&#34;&#34;
    url = f&#34;/api/contrib/item/{eid}/field/{field}?action=edit&#34;
    response = client.get(url)
    text = response.get_data(as_text=True)
    thisRe = fieldEditRe(eid, field)
    valueStr = thisRe.findall(text)
    values = valueRe.findall(valueStr[0])
    valueDict = {value: eid for (eid, value) in values}
    return valueDict


def getValueTable(client, table, requestInfo, dest):
    &#34;&#34;&#34;Get a mapping of values in a value table to their object ids.

    We obtain the mapping by asking for an edit view of a field that
    takes values in this value table.
    Then we inspect the edit widget and read off the values and ids.

    Except for the user table, there we directly list the items.

    The mapping is stored in the dict `dest` keyed by the
    name of the valueTable.

    Parameters
    ----------
    table: string
        The name of a value table

    requestInfo: dict
        Info from the request, such as text, fields, messages, eid.

    Returns
    -------
    dict
        The stored value dict for this table
    &#34;&#34;&#34;

    if table == &#34;user&#34;:
        response = client.get(f&#34;/user/list&#34;)
        text = response.get_data(as_text=True)
        dest[table] = findUsers(text)
    else:
        eid = requestInfo[&#34;eid&#34;]
        valueDict = getRelatedValues(client, eid, table)
        dest[table] = valueDict
    return dest[table]</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="helpers.addContrib"><code class="name flex">
<span>def <span class="ident">addContrib</span></span>(<span>client)</span>
</code></dt>
<dd>
<section class="desc"><p>Adds a contribution on behalf of an authenticated user.</p>
<p>The response texts will be analysed into messages and fields, the eid
of the new contribution will be read off.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>text</code></strong> :&ensp;<code>string</code></dt>
<dd>The complete response text</dd>
<dt><strong><code>fields</code></strong> :&ensp;<code>dict</code></dt>
<dd>All fields and their values</dd>
<dt><strong><code>msgs</code></strong> :&ensp;<code>list</code></dt>
<dd>All entries that have been flashed (and arrived in the flash bar)</dd>
<dt><strong><code>eid</code></strong> :&ensp;<code>str</code>(<code>ObjectId</code>)</dt>
<dd>The id of the inserted contribution.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def addContrib(client):
    &#34;&#34;&#34;Adds a contribution on behalf of an authenticated user.

    The response texts will be analysed into messages and fields, the eid
    of the new contribution will be read off.

    Returns
    -------
    text: string
        The complete response text
    fields: dict
        All fields and their values
    msgs: list
        All entries that have been flashed (and arrived in the flash bar)
    eid: str(ObjectId)
        The id of the inserted contribution.
    &#34;&#34;&#34;

    response = client.get(f&#34;/api/contrib/insert&#34;, follow_redirects=True)
    text = response.get_data(as_text=True)
    fields = {field: value for (field, value) in fieldRe.findall(text)}
    msgs = findMsg(text)
    eid = findEid(text)
    assert &#34;item added&#34; in msgs
    return (text, fields, msgs, eid)</code></pre>
</details>
</dd>
<dt id="helpers.fieldEditRe"><code class="name flex">
<span>def <span class="ident">fieldEditRe</span></span>(<span>eid, field)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def fieldEditRe(eid, field):
    return re.compile(
        r&#34;&#34;&#34;
    &lt;span\ [^&gt;]*?eid=[&#39;&#34;]{eid}[&#39;&#34;]\s+field=[&#39;&#34;]{field}[&#39;&#34;].*?
    &lt;div\ wtype=[&#39;&#34;]related[&#39;&#34;]\ .*?
    &lt;div\ class=[&#39;&#34;]wvalue[&#39;&#34;]&gt;(.*?)&lt;/div&gt;
    &#34;&#34;&#34;.format(
            eid=eid, field=field
        ),
        re.S | re.X,
    )</code></pre>
</details>
</dd>
<dt id="helpers.findContrib"><code class="name flex">
<span>def <span class="ident">findContrib</span></span>(<span>client)</span>
</code></dt>
<dd>
<section class="desc"><p>Looks up a contribution.</p>
<p>The response texts will be analysed into messages and fields, the eid
of the new contribution will be read off.</p>
<p>We assume that there is still only one contribution in the database.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>text</code></strong> :&ensp;<code>string</code></dt>
<dd>The complete response text</dd>
<dt><strong><code>fields</code></strong> :&ensp;<code>dict</code></dt>
<dd>All fields and their values</dd>
<dt><strong><code>msgs</code></strong> :&ensp;<code>list</code></dt>
<dd>All entries that have been flashed (and arrived in the flash bar)</dd>
<dt><strong><code>eid</code></strong> :&ensp;<code>str</code>(<code>ObjectId</code>)</dt>
<dd>The id of the inserted contribution.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def findContrib(client):
    &#34;&#34;&#34;Looks up a contribution.

    The response texts will be analysed into messages and fields, the eid
    of the new contribution will be read off.

    We assume that there is still only one contribution in the database.

    Returns
    -------
    text: string
        The complete response text
    fields: dict
        All fields and their values
    msgs: list
        All entries that have been flashed (and arrived in the flash bar)
    eid: str(ObjectId)
        The id of the inserted contribution.
    &#34;&#34;&#34;

    response = client.get(f&#34;/contrib/list&#34;)
    text = response.get_data(as_text=True)
    fields = {field: value for (field, value) in fieldRe.findall(text)}
    msgs = findMsg(text)
    eid = findEid(text)
    return (text, fields, msgs, eid)</code></pre>
</details>
</dd>
<dt id="helpers.findEid"><code class="name flex">
<span>def <span class="ident">findEid</span></span>(<span>text)</span>
</code></dt>
<dd>
<section class="desc"><p>Get the entity id from a response.</p>
<p>If the response shows a record, dig out its entity id.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>text</code></strong> :&ensp;<code>string</code></dt>
<dd>The response text.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>string</code>(<code>ObjectId</code>)</dt>
<dd>&nbsp;</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def findEid(text):
    &#34;&#34;&#34;Get the entity id from a response.

    If the response shows a record, dig out its entity id.

    Parameters
    ----------
    text: string
        The response text.

    Returns
    -------
    string(ObjectId)
    &#34;&#34;&#34;

    return eidRe.findall(text)[0]</code></pre>
</details>
</dd>
<dt id="helpers.findFields"><code class="name flex">
<span>def <span class="ident">findFields</span></span>(<span>text)</span>
</code></dt>
<dd>
<section class="desc"><p>Get the fields from a response.</p>
<p>If the response shows a record, dig out its fields and values.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>They are neatly packaged in comment lines!</p>
</div>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>text</code></strong> :&ensp;<code>string</code></dt>
<dd>The response text.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>dict</code></dt>
<dd>Keyed by field names, valued by field values.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def findFields(text):
    &#34;&#34;&#34;Get the fields from a response.

    If the response shows a record, dig out its fields and values.

    !!! hint
        They are neatly packaged in comment lines!

    Parameters
    ----------
    text: string
        The response text.

    Returns
    -------
    dict
        Keyed by field names, valued by field values.
    &#34;&#34;&#34;

    return {field: value for (field, value) in fieldRe.findall(text)}</code></pre>
</details>
</dd>
<dt id="helpers.findMsg"><code class="name flex">
<span>def <span class="ident">findMsg</span></span>(<span>text)</span>
</code></dt>
<dd>
<section class="desc"><p>Get flashed messages from a response.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>text</code></strong> :&ensp;<code>string</code></dt>
<dd>The response text.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>set</code></dt>
<dd>All text messages found in the flash bar.</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def findMsg(text):
    &#34;&#34;&#34;Get flashed messages from a response.

    Parameters
    ----------
    text: string
        The response text.

    Returns
    -------
    set
        All text messages found in the flash bar.
    &#34;&#34;&#34;

    return set(msgRe.findall(text))</code></pre>
</details>
</dd>
<dt id="helpers.findUsers"><code class="name flex">
<span>def <span class="ident">findUsers</span></span>(<span>text)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def findUsers(text):
    return {
        name.split()[0].lower(): (eid, name) for (eid, name) in userRe.findall(text)
    }</code></pre>
</details>
</dd>
<dt id="helpers.getRelatedValues"><code class="name flex">
<span>def <span class="ident">getRelatedValues</span></span>(<span>client, eid, field)</span>
</code></dt>
<dd>
<section class="desc"><p>Get an editable view on a field that represents a related value.""</p>
<p>We check the contents.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getRelatedValues(client, eid, field):
    &#34;&#34;&#34;Get an editable view on a field that represents a related value.&#34;&#34;

    We check the contents.

    &#34;&#34;&#34;
    url = f&#34;/api/contrib/item/{eid}/field/{field}?action=edit&#34;
    response = client.get(url)
    text = response.get_data(as_text=True)
    thisRe = fieldEditRe(eid, field)
    valueStr = thisRe.findall(text)
    values = valueRe.findall(valueStr[0])
    valueDict = {value: eid for (eid, value) in values}
    return valueDict</code></pre>
</details>
</dd>
<dt id="helpers.getValueTable"><code class="name flex">
<span>def <span class="ident">getValueTable</span></span>(<span>client, table, requestInfo, dest)</span>
</code></dt>
<dd>
<section class="desc"><p>Get a mapping of values in a value table to their object ids.</p>
<p>We obtain the mapping by asking for an edit view of a field that
takes values in this value table.
Then we inspect the edit widget and read off the values and ids.</p>
<p>Except for the user table, there we directly list the items.</p>
<p>The mapping is stored in the dict <code>dest</code> keyed by the
name of the valueTable.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>table</code></strong> :&ensp;<code>string</code></dt>
<dd>The name of a value table</dd>
<dt><strong><code>requestInfo</code></strong> :&ensp;<code>dict</code></dt>
<dd>Info from the request, such as text, fields, messages, eid.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>dict</code></dt>
<dd>The stored value dict for this table</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getValueTable(client, table, requestInfo, dest):
    &#34;&#34;&#34;Get a mapping of values in a value table to their object ids.

    We obtain the mapping by asking for an edit view of a field that
    takes values in this value table.
    Then we inspect the edit widget and read off the values and ids.

    Except for the user table, there we directly list the items.

    The mapping is stored in the dict `dest` keyed by the
    name of the valueTable.

    Parameters
    ----------
    table: string
        The name of a value table

    requestInfo: dict
        Info from the request, such as text, fields, messages, eid.

    Returns
    -------
    dict
        The stored value dict for this table
    &#34;&#34;&#34;

    if table == &#34;user&#34;:
        response = client.get(f&#34;/user/list&#34;)
        text = response.get_data(as_text=True)
        dest[table] = findUsers(text)
    else:
        eid = requestInfo[&#34;eid&#34;]
        valueDict = getRelatedValues(client, eid, table)
        dest[table] = valueDict
    return dest[table]</code></pre>
</details>
</dd>
<dt id="helpers.isRight"><code class="name flex">
<span>def <span class="ident">isRight</span></span>(<span>client, url)</span>
</code></dt>
<dd>
<section class="desc"><p>Get data and see whether that went right.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>client</code></strong> :&ensp;<code>function</code></dt>
<dd>&nbsp;</dd>
<dt><strong><code>url</code></strong> :&ensp;<code>string</code>(<code>url</code>)</dt>
<dd>The url to retrieve from the server</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def isRight(client, url):
    &#34;&#34;&#34;Get data and see whether that went right.

    Parameters
    ----------
    client: function
    url: string(url)
        The url to retrieve from the server
    &#34;&#34;&#34;

    return isStatus(client, url, True)</code></pre>
</details>
</dd>
<dt id="helpers.isStatus"><code class="name flex">
<span>def <span class="ident">isStatus</span></span>(<span>client, url, status)</span>
</code></dt>
<dd>
<section class="desc"><p>Get data and see whether that went right or wrong.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>client</code></strong> :&ensp;<code>function</code></dt>
<dd>&nbsp;</dd>
<dt><strong><code>url</code></strong> :&ensp;<code>string</code>(<code>url</code>)</dt>
<dd>The url to retrieve from the server</dd>
<dt><strong><code>status</code></strong> :&ensp;<code>boolean</code></dt>
<dd>Whether it is expected to be successful</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def isStatus(client, url, status):
    &#34;&#34;&#34;Get data and see whether that went right or wrong.

    Parameters
    ----------
    client: function
    url: string(url)
        The url to retrieve from the server
    status: boolean
        Whether it is expected to be successful
    &#34;&#34;&#34;

    response = client.get(url)
    if status:
        assert response.status_code == 302
    else:
        assert response.status_code == 303</code></pre>
</details>
</dd>
<dt id="helpers.isWrong"><code class="name flex">
<span>def <span class="ident">isWrong</span></span>(<span>client, url)</span>
</code></dt>
<dd>
<section class="desc"><p>Get data and see whether that went wrong.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>client</code></strong> :&ensp;<code>function</code></dt>
<dd>&nbsp;</dd>
<dt><strong><code>url</code></strong> :&ensp;<code>string</code>(<code>url</code>)</dt>
<dd>The url to retrieve from the server</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def isWrong(client, url):
    &#34;&#34;&#34;Get data and see whether that went wrong.

    Parameters
    ----------
    client: function
    url: string(url)
        The url to retrieve from the server
    &#34;&#34;&#34;

    return isStatus(client, url, False)</code></pre>
</details>
</dd>
<dt id="helpers.makeClient"><code class="name flex">
<span>def <span class="ident">makeClient</span></span>(<span>app, eppn)</span>
</code></dt>
<dd>
<section class="desc"><p>Logs in a specific user.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>app</code></strong> :&ensp;<code>object</code></dt>
<dd>&nbsp;</dd>
<dt><strong><code>eppn</code></strong> :&ensp;<code>string</code></dt>
<dd>Identity of the user</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def makeClient(app, eppn):
    &#34;&#34;&#34;Logs in a specific user.

    Parameters
    ----------
    app: object
    eppn: string
        Identity of the user
    &#34;&#34;&#34;

    client = app.test_client()
    response = client.get(f&#34;/login?eppn={eppn}&#34;)
    if response.status_code == 302:
        return client
    return None</code></pre>
</details>
</dd>
<dt id="helpers.modifyField"><code class="name flex">
<span>def <span class="ident">modifyField</span></span>(<span>client, table, eid, field, newValue)</span>
</code></dt>
<dd>
<section class="desc"><p>Post data to update a field and analyse the response for the effect.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def modifyField(client, table, eid, field, newValue):
    &#34;&#34;&#34;Post data to update a field and analyse the response for the effect.&#34;&#34;&#34;

    text = postJson(
        client, f&#34;/api/{table}/item/{eid}/field/{field}?action=view&#34;, newValue
    )
    fields = findFields(text)
    return (text, fields)</code></pre>
</details>
</dd>
<dt id="helpers.postJson"><code class="name flex">
<span>def <span class="ident">postJson</span></span>(<span>client, url, value)</span>
</code></dt>
<dd>
<section class="desc"><p>Post data to a url and retrieve the response text.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>client</code></strong> :&ensp;<code>function</code></dt>
<dd>&nbsp;</dd>
<dt><strong><code>url</code></strong> :&ensp;<code>string</code>(<code>url</code>)</dt>
<dd>&nbsp;</dd>
<dt><strong><code>value</code></strong> :&ensp;<code>mixed</code></dt>
<dd>The value to post.
Will be wrapped into JSON with a proper header.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>string</code></dt>
<dd>The response text</dd>
</dl></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def postJson(client, url, value):
    &#34;&#34;&#34;Post data to a url and retrieve the response text.

    Parameters
    ----------
    client: function
    url: string(url)
    value: mixed
        The value to post.
        Will be wrapped into JSON with a proper header.

    Returns
    -------
    string
        The response text
    &#34;&#34;&#34;

    response = client.post(
        url, data=json.dumps(dict(save=value)), content_type=&#34;application/json&#34;,
    )
    text = response.get_data(as_text=True)

    return text</code></pre>
</details>
</dd>
<dt id="helpers.viewField"><code class="name flex">
<span>def <span class="ident">viewField</span></span>(<span>client, table, eid, field)</span>
</code></dt>
<dd>
<section class="desc"><p>Get the response for showing a field.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def viewField(client, table, eid, field):
    &#34;&#34;&#34;Get the response for showing a field.&#34;&#34;&#34;

    url = f&#34;/api/{table}/item/{eid}/field/{field}?action=view&#34;
    print(&#34;URL&#34;, url)
    response = client.get(url)
    print(&#34;RESPONSE&#34;, response)
    text = response.get_data(as_text=True)
    fields = findFields(text)
    return (text, fields)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="helpers.addContrib" href="#helpers.addContrib">addContrib</a></code></li>
<li><code><a title="helpers.fieldEditRe" href="#helpers.fieldEditRe">fieldEditRe</a></code></li>
<li><code><a title="helpers.findContrib" href="#helpers.findContrib">findContrib</a></code></li>
<li><code><a title="helpers.findEid" href="#helpers.findEid">findEid</a></code></li>
<li><code><a title="helpers.findFields" href="#helpers.findFields">findFields</a></code></li>
<li><code><a title="helpers.findMsg" href="#helpers.findMsg">findMsg</a></code></li>
<li><code><a title="helpers.findUsers" href="#helpers.findUsers">findUsers</a></code></li>
<li><code><a title="helpers.getRelatedValues" href="#helpers.getRelatedValues">getRelatedValues</a></code></li>
<li><code><a title="helpers.getValueTable" href="#helpers.getValueTable">getValueTable</a></code></li>
<li><code><a title="helpers.isRight" href="#helpers.isRight">isRight</a></code></li>
<li><code><a title="helpers.isStatus" href="#helpers.isStatus">isStatus</a></code></li>
<li><code><a title="helpers.isWrong" href="#helpers.isWrong">isWrong</a></code></li>
<li><code><a title="helpers.makeClient" href="#helpers.makeClient">makeClient</a></code></li>
<li><code><a title="helpers.modifyField" href="#helpers.modifyField">modifyField</a></code></li>
<li><code><a title="helpers.postJson" href="#helpers.postJson">postJson</a></code></li>
<li><code><a title="helpers.viewField" href="#helpers.viewField">viewField</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.2</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>