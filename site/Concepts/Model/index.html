<!doctype html><html lang=en class=no-js> <head><link href=https://fonts.gstatic.com rel=preconnect crossorigin><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="The technical documentation of the DARIAH Contribution Tool. Design, specs, rationales, patterns, diagrams.
"><link href=https://dans-labs.github.io/dariah-contrib/Concepts/Model/ rel=canonical><meta name=author content="Dirk Roorda"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../icons/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-dans-4.4.1"><title>Model - Tech Doc DARIAH contribution tool</title><link rel=stylesheet href=../../assets/stylesheets/application.27a306a7.css><script src=../../assets/javascripts/modernizr.74668098.js></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700|Glegoo:300,400,400i,700|Ubuntu+Mono&display=swap"><style>.body-type,body,input{font-family:"Open Sans",sans-serif}.head-type,h1,h2,h3,h4,h5{font-family:"Glegoo",serif}.code-type,code,kbd,pre{font-family:"Ubuntu Mono",monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#model tabindex=1 class=md-skip> Skip to content </a> <header class="md-header md-dev" data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://www.dariah.eu title=DARIAH class="md-header-nav__button md-logo"> <img src=../../images/dariah.png height=50> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://dans-labs.github.io/dariah-contrib/ title="Tech Doc DARIAH contribution tool" class="md-header-nav__button md-logo"> <img src=../../images/inkind_logo.png height=50> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title head-type" data-md-component=title> <span class=md-header-nav__topic> Tech Doc DARIAH contribution tool <span class="md-dev-inline head-type"> still in beta </span> </span> <span class=md-header-nav__topic> Model <span class="md-dev-inline head-type"> still in beta </span> </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/dans-labs/dariah-contrib/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Dans-labs/dariah-contrib </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. title=Home class="md-tabs__link head-type"> Home </a> </li> <li class=md-tabs__item> <a href=../../About/Codebase/ title=About class="md-tabs__link head-type"> About </a> </li> <li class=md-tabs__item> <a href=../../Functionality/Business/ title=Functionality class="md-tabs__link head-type"> Functionality </a> </li> <li class=md-tabs__item> <a href=../../Legacy/Content/ title=Legacy class="md-tabs__link head-type"> Legacy </a> </li> <li class=md-tabs__item> <a href=./ title=Concepts class="md-tabs__link md-tabs__link--active head-type"> Concepts </a> </li> <li class=md-tabs__item> <a href=../../Server/Authentication/ title=Server class="md-tabs__link head-type"> Server </a> </li> <li class=md-tabs__item> <a href=../../Technology/Tech/ title=Technology class="md-tabs__link head-type"> Technology </a> </li> <li class=md-tabs__item> <a href=../../Integration/API/ title=Integration class="md-tabs__link head-type"> Integration </a> </li> <li class=md-tabs__item> <a href=../../Maintenance/Deploy/ title=Maintenance class="md-tabs__link head-type"> Maintenance </a> </li> </ul> </div> </nav> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title head-type md-nav__title--site" for=__drawer> <a href=https://dans-labs.github.io/dariah-contrib/ title="Tech Doc DARIAH contribution tool" class="md-nav__button md-logo"> <img src=../../images/inkind_logo.png width=48 height=48> </a> Tech Doc DARIAH contribution tool </label> <div class=md-nav__source> <a href=https://github.com/dans-labs/dariah-contrib/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Dans-labs/dariah-contrib </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class="md-nav__link head-type"> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class="md-nav__link head-type" for=nav-2> About </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-2> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../About/Codebase/ title=Codebase class="md-nav__link head-type"> Codebase </a> </li> <li class=md-nav__item> <a href=../../About/Stats/ title=Stats class="md-nav__link head-type"> Stats </a> </li> <li class=md-nav__item> <a href=../../About/News/ title=News class="md-nav__link head-type"> News </a> </li> <li class=md-nav__item> <a href=../../About/Lessons/ title=Lessons class="md-nav__link head-type"> Lessons </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class="md-nav__link head-type" for=nav-3> Functionality </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-3> Functionality </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Functionality/Business/ title=Business class="md-nav__link head-type"> Business </a> </li> <li class=md-nav__item> <a href=../../Functionality/Tables/ title=Tables class="md-nav__link head-type"> Tables </a> </li> <li class=md-nav__item> <a href=../../Functionality/Workflow/ title=Workflow class="md-nav__link head-type"> Workflow </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class="md-nav__link head-type" for=nav-4> Legacy </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-4> Legacy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Legacy/Content/ title=Content class="md-nav__link head-type"> Content </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5 checked> <label class="md-nav__link head-type" for=nav-5> Concepts </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-5> Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active head-type" for=__toc> Model </label> <a href=./ title=Model class="md-nav__link md-nav__link--active head-type"> Model </a> <nav class="md-nav md-nav--secondary"> <label class="md-nav__title head-type" for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#mongodb title=MongoDB class="md-nav__link head-type"> MongoDB </a> </li> <li class=md-nav__item> <a href=#data-model title="Data model" class="md-nav__link head-type"> Data model </a> </li> <li class=md-nav__item> <a href=#permission-model title="Permission model" class="md-nav__link head-type"> Permission model </a> </li> <li class=md-nav__item> <a href=#name-handling title="Name handling" class="md-nav__link head-type"> Name handling </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class="md-nav__link head-type" for=nav-6> Server </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-6> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Server/Authentication/ title=Authentication class="md-nav__link head-type"> Authentication </a> </li> <li class=md-nav__item> <a href=../../Server/Server/ title=Server class="md-nav__link head-type"> Server </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class="md-nav__link head-type" for=nav-7> Technology </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-7> Technology </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Technology/Tech/ title=Tech class="md-nav__link head-type"> Tech </a> </li> <li class=md-nav__item> <a href=../../Technology/ES6/ title=ES6 class="md-nav__link head-type"> ES6 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class="md-nav__link head-type" for=nav-8> Integration </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-8> Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Integration/API/ title=API class="md-nav__link head-type"> API </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class="md-nav__link head-type" for=nav-9> Maintenance </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class="md-nav__title head-type" for=nav-9> Maintenance </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Maintenance/Deploy/ title=Deploy class="md-nav__link head-type"> Deploy </a> </li> <li class=md-nav__item> <a href=../../api/html/control/ title=Techdoc class="md-nav__link head-type"> Techdoc </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class="md-nav__title head-type" for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#mongodb title=MongoDB class="md-nav__link head-type"> MongoDB </a> </li> <li class=md-nav__item> <a href=#data-model title="Data model" class="md-nav__link head-type"> Data model </a> </li> <li class=md-nav__item> <a href=#permission-model title="Permission model" class="md-nav__link head-type"> Permission model </a> </li> <li class=md-nav__item> <a href=#name-handling title="Name handling" class="md-nav__link head-type"> Name handling </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/dans-labs/dariah-contrib/edit/master/docs/Concepts/Model.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1 id=model>Model<a class=headerlink href=#model title="Permanent link">&para;</a></h1> <p>This application contains a generic engine to display MongoDB data according to any specified data model, respecting access privileges.</p> <h2 id=mongodb>MongoDB<a class=headerlink href=#mongodb title="Permanent link">&para;</a></h2> <p>We store the data in a <a href=https://docs.mongodb.com>MongoDB</a> .</p> <details class=details><summary>Data as documents</summary><p>A MongoDB does not work with a fixed schema. A MongoDB <em>collection</em> consists of <em>documents</em>, which are essentially JSON-like structures, arbitrarily large and arbitrarily nested. That makes it easy to add new kinds of data to documents and collections when the need arises to do so. This will not break the existing code.</p> <p>MongoDB is optimized to read quickly, at the cost of more expensive data manipulation operations. Its documentation favours storing related data inside the main document. This increases the redundancy of the data and may lead to consistency problems, unless the application tries to enforce consistency somehow.</p> <p>In this app, with a limited amount of data, we use MongoDB primarily for its flexibility. We still adhere largely to SQL-like practices when we deal with related tables. So instead of storing the information of related documents directly inside the main document, we only store references to related documents inside the main documents.</p> </details> <details class=caution open=open><summary>Terminology</summary><p>Because our treatment of data is still very relational, we prefer wording derived from SQL databases, at least in the present documentation:</p> <table> <thead> <tr> <th>MongoDB</th> <th>SQL</th> </tr> </thead> <tbody> <tr> <td><em>collection</em></td> <td><strong>table</strong></td> </tr> <tr> <td><em>document</em></td> <td><strong>record</strong></td> </tr> </tbody> </table> </details> <h2 id=data-model>Data model<a class=headerlink href=#data-model title="Permanent link">&para;</a></h2> <p>The data model has a generic part and a table specific part.</p> <p>The generic part is specified in <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/server/yaml/tables.yaml>tables.yaml</a> .</p> <details class=abstract><summary>classification of tables</summary><details class=details><summary>user tables</summary><p>The main tables that receive user content: <em>contrib</em>, <em>assessment</em>, <em>review</em>.</p> </details> <details class=details><summary>user entry tables</summary><p>Also tables that receive user content, namely the entries users make in assessments and reviews: <em>criteriaEntry</em> and <em>reviewEntry</em>.</p> </details> <details class=details><summary>valueTables</summary><p>Tables that define the values for fields in other tables, such as <em>discipline</em>, <em>keyword</em>, <em>tadirahObject</em>. The <em>user</em> table is also a value table.</p> </details> <details class=details><summary>systemTables</summary><p>A subset of the value tables: <em>decision</em> and <em>permissionGroup</em>. Essential for the integrity of the business logic.</p> </details> </details> <details class=abstract><summary>details</summary><p>Specification of detail records: which tables act as details for which masters?</p> <details class=explanation><summary>master-detail</summary><p>A record may have <em>detail records</em> associated with it. We call such a record a <em>master record</em> with respect to its details.</p> <p>Details are records, usually in another table, having a field that points to their master record by means of an <code>_id</code> value.</p> </details> <details class=hint open=open><summary>Convention</summary><p>Whenever possible, the field in a detail table that points to a master is named after the master table.</p> </details> </details> <details class=details><summary>cascade</summary><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class=code><div class=codehilite><pre><span></span>When a master record is deleted,
its details have a dangling reference to a non-existing master record.
In some cases it is desirable to delete the detail records as well.

??? example &quot;criteriaEntry&quot;
    *criteriaEntry* records are deleted with their
    master: an assessment record.

??? example &quot;criteria&quot;
    *criteria* records are *not* deleted with their
    master record.

???+ hint &quot;Deletion prohibited&quot;
    In all cases where a record has dependencies, deletion of such
    a record is prohibited, unless all of its dependencies
    are marked for cascade-deletion.

    In order to remove a contribution with assessments and reviews,
    you first have to delete all its assessments and reviews.
</pre></div> </td></tr></table> </details> <details class=abstract><summary>provenance</summary><p>Fields for recording the edit history of a record.</p> <details class=details open=open><summary>provenanceSpecs</summary><p>Field specifications for the provenance fields.</p> <p>We have these fields:</p> <details class=details><summary>editors</summary><p>List of ids of non-owner users that may edit this record, even if their group permissions do not allow it.</p> </details> <details class=details><summary>creator</summary><p>Id of the user that created the record.</p> </details> <details class=details><summary>dateCreated</summary><p>Datetime when the record was created.</p> </details> <details class=details><summary>modified</summary><p>Trail of modification events, each event has the name of the user who caused the change and the datetime when it happened. The trail will be weeded out over time.</p> </details> <p>The field "editors" may be changed by the owner of a record, and by people with higher powers such as the backoffice, not by the editors themselves (unless they also have higher power).</p> <p>All other fields cannot be modified by users, not even by users with higher powers. Only the system itself will write and update these fields.</p> <details class=caution><summary>Backdoors</summary><p>A person with access to the underlying Mongo DB can do with the data what (s)he wants.</p> <p>This requires a direct interaction with the machine on which the database resides. Webaccess is not sufficient.</p> </details> </details> </details> <p>The table specific models are in the yaml files in <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/server/tables>tables</a> .</p> <p>The table models consist of the specifications of the fields in that table. For each field there is a key under which some specs are written.</p> <details class=details><summary>fieldSpecs</summary><details class=details><summary>label</summary><p>A user-friendly display name of the field.</p> </details> <details class=details><summary>type</summary><p>The data type of the field. It can be a plain data type, or the name of a value table that contains the possible values of this field.</p> <p>Possible plain types are:</p> <details class=details><summary>text</summary><p>A string of characters, usually just a one-liner.</p> </details> <details class=details><summary>url</summary><p>A syntactically valid URL: i.e. a string of text that can be interpreted as a URL. A validation routine will check this.</p> </details> <details class=details><summary>email</summary><p>A syntactically valid email address. A validation routine will check this.</p> </details> <details class=details><summary>markdown</summary><p>A string of characters, which may extend to several pages, formaated as Markdown text.</p> </details> <details class=details><summary>bool2</summary><p><code>true</code> or <code>false</code>.</p> </details> <details class=details><summary>bool3</summary><p><code>true</code> , <code>null</code>, or <code>false</code>.</p> </details> <details class=details><summary>int</summary><p>An integer number.</p> </details> <details class=details><summary>decimal</summary><p>An decimal number.</p> </details> <details class=details><summary>money</summary><p>An decimal number with an implicit monetary unit: â‚¬.</p> </details> <details class=details><summary>datetime</summary><p>A date time, mostly represented in its <a href=https://en.wikipedia.org/wiki/ISO_8601>ISO 8601</a> format.</p> </details> <details class=details><summary>Related values</summary><p>When a field refers to other records, there is much more to specify. In this case <code>tType</code> is the name of a value table.</p> </details> </details> <details class=details><summary>multiple</summary><p>Whether there is only one value allowed for this field, or a list of values.</p> </details> <details class=details><summary>perm</summary><p>Who has read and edit access to this field?</p> </details> <details class=hint open=open><summary>Conventions</summary><p>The specification is greatly simplified by conventions. Only what deviates from the following conventions needs to be specified:</p> <ul> <li><strong>label</strong>: same as table name, first letter capitalized</li> <li><strong>type</strong>: <code>text</code></li> <li><strong>multiple</strong>: <code>false</code></li> <li><strong>perm.read</strong>: <code>public</code></li> <li><strong>perm.edit</strong>: <code>edit</code>, i.e. the creator and the editors of the record.</li> <li>See below for more about permissions.</li> </ul> </details> </details> <h2 id=permission-model>Permission model<a class=headerlink href=#permission-model title="Permanent link">&para;</a></h2> <p>The authorization system is built on the basis of <em>groups</em> and <em>permission</em> levels.</p> <p><em>Users</em> are assigned to groups, and <em>things</em> require permission levels.</p> <p>When a user wants to act upon a thing, his/her group will be compared to the permission level of the thing, and based on the outcome of the comparison, the action will be allowed or forbidden.</p> <p>The configuration of the permissions system as a whole is in <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/server/yaml/perm.yaml>perm</a> .</p> <p>The the table-specific permissions are under the <code>perm</code> keys of the table config files mentioned above.</p> <details class=abstract><summary>Groups</summary><p>Under the key <code>roles</code> the groups and pseudo groups are given. Here is a short description.</p> <table> <thead> <tr> <th>group</th> <th>is pseudo</th> <th>description</th> </tr> </thead> <tbody> <tr> <td>nobody</td> <td>no</td> <td>deliberately empty: no user is member of this group</td> </tr> <tr> <td>public</td> <td>no</td> <td>user, not logged in</td> </tr> <tr> <td>auth</td> <td>no</td> <td>authenticated user</td> </tr> <tr> <td>edit</td> <td>yes</td> <td>authenticated user and editor of records in question</td> </tr> <tr> <td>own</td> <td>yes</td> <td>authenticated user and creator of records in question</td> </tr> <tr> <td>coord</td> <td>no</td> <td>national coordinator</td> </tr> <tr> <td>office</td> <td>no</td> <td>back office user</td> </tr> <tr> <td>system</td> <td>no</td> <td>system administrator</td> </tr> <tr> <td>root</td> <td>no</td> <td>full control</td> </tr> </tbody> </table> <details class=abstract><summary>Explanation</summary><p>Groups are attributes of users, as an indication of the power they have.</p> <p>Informally, we need to distinguish between:</p> <details class=details><summary>Nobody</summary><p><code>nobody</code> is a group without users, and if there were users, they could not do anything.</p> <p>Useful in cases where you want to state that something is not permitted to anybody.</p> </details> <details class=details><summary>The public</summary><p><code>public</code> is a group for unidentified an unauthenticated users.</p> <p>They can only list/read public information and have no right to edit anything and can do no actions that change anything in the database.</p> </details> <details class=details><summary>Authenticated users</summary><p><code>auth</code> is the group of DARIAH users authenticated by the DARIAH Identity provider.</p> <p>This is the default group for logged-in users.</p> <p>They can see DARIAH internal information (within limits) an can add items and then modify/delete them, within limits.</p> </details> <details class=details><summary>National coordinators</summary><p><code>coord</code> is the group of National Coordinators. They are DARIAH users that coordinate the DARIAH outputs for an entire member country.</p> <p>They can (de)select contributions and see their cost fields but only for contributions in the countries they coordinate.</p> </details> <details class=details><summary>Backoffice employees</summary><p><code>office</code> is the group of users that work for the DARIAH ERIC office.</p> <p>They can modify records created by others (within limits), but cannot perform technical actions that affect the system.</p> </details> <details class=details><summary>System managers</summary><p><code>sysadmin</code> is the group of users that control the system, not only through the interface of the app, but also with low-level access to the database and the machine that serves the app.</p> <p>Can modify system-technical records, within limits.</p> </details> <details class=details><summary>root</summary><p><code>root</code> is the one user that can bootstrap the system.</p> <p>Complete rights. Still there are untouchable things, that would compromise the integrity of the system. Even root cannot modify those from within the system.</p> <p>Root is the owner of the system, and can assign people to the roles of system managers and backoffice employees.</p> <p>From there on, these latter groups can do everything that is needed for the day-to-day operation of the functions that the system is designed to fulfill.</p> </details> <details class=caution><summary>Pseudo groups</summary><p>In some cases, the identity of the user is relevant, namely when users have a special relationship to the records they want to modify, such as <em>ownership</em>, <em>editorship</em>, etc. When those relationships apply, users are put in a pseudo group such <code>own</code> or <code>edit</code>.</p> </details> </details> </details> <details class=hint open=open><summary>Conventions</summary><p>For deletion of records we have a convention without exceptions:</p> <ul> <li>records in userEntry tables cannot be deleted directly, only as a result of deleting their master record.</li> <li>Users that have created a record or are mentioned in its <code>editors</code> field may also delete that record if no workflow conditions forbid it.</li> <li>Super users may delete records in user tables.</li> <li>Nobody may delete records in value tables.</li> </ul> </details> <details class=abstract><summary>Assigning users to groups</summary><p>Once users are in a group, their permissions are known. But there are also permissions to regulate who may assign groups to users.</p> <details class=caution open=open><summary>Not yet implemented</summary><p>These rules are not yet in force in the redesigned system</p> </details> <p>These permissions derive from the groups as well, with a few additional rules:</p> <ul> <li>nobody can assign anybody to the group <code>nobody</code>;</li> <li>a person can only add people to groups that have at most his/her own power;</li> <li>a person can only assign groups to people that have less power than him/herself.</li> </ul> </details> <details class=note><summary>Notes</summary><details class=example><summary>Example</summary><ul> <li>If you are <code>office</code>, you cannot promote yourself or anyone else to <code>system</code> or <code>root</code>.</li> <li>If you are <code>office</code>, you cannot demote another member of <code>office</code> to the group <code>auth</code>.</li> <li>You cannot demote/promote your peers, or the ones above you.</li> <li>You can demote yourself, but not promote yourself.</li> <li>You can demote people below you.</li> <li>You can promote people below you, but only up to your own level.</li> </ul> </details> <details class=note><summary><code>nobody</code></summary><p>Note that users in group <code>nobody</code> have no rights. There should be no users in that group, but if by misconfiguration there is a user in that group, (s)he can do nothing.</p> </details> <details class=caution><summary><code>root</code></summary><p>A consequence of the promotion/demotion rules is that if there is no user in the group <code>root</code>, nobody can be made <code>root</code> from within the system.</p> <p>Likewise, if a user is root, nobody can take away his/her root status, except him/herself.</p> <p>When importing data into the system by means of <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/scripts/load.sh>load.sh</a> you can specify to make a specific user <code>root</code>. Which user that is, is specified in <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/import/config.yaml>config.yaml</a> , see <code>rootUser</code>.</p> <p>The command is</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>./load.sh -r
</pre></div> </td></tr></table> <p>to be executed in the home directory on the server.</p> <p>Alternatively, issuing</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span>./load.sh -R
</pre></div> </td></tr></table> <p>will also convert all <em>other</em> root users on the system to <em>office</em> users.</p> <p>Once the root user is in place, (s)he can assign system admins and back office people. Once those are in place, the daily governance of the system can take place.</p> </details> </details> <h2 id=name-handling>Name handling<a class=headerlink href=#name-handling title="Permanent link">&para;</a></h2> <details class=details><summary>The problem</summary><p>There are a lot of names in these yaml files. The most obvious way to use them in our programs (Python on the server, JavaScript on the client) is by just mentioning them as strings, e.g.:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=n>title</span> <span class=o>=</span> <span class=n>DM</span><span class=p>[</span><span class=s1>&#39;tables&#39;</span><span class=p>][</span><span class=s1>&#39;permissionGroup&#39;</span><span class=p>][</span><span class=s1>&#39;title&#39;</span><span class=p>]</span>
</pre></div> </td></tr></table> <p>and</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=nx>title</span> <span class=o>=</span> <span class=nx>DM</span><span class=p>.</span><span class=nx>tables</span><span class=p>.</span><span class=nx>permissionGroup</span><span class=p>.</span><span class=nx>title</span>
</pre></div> </td></tr></table> <p>or</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><span class=kr>const</span> <span class=p>{</span> <span class=nx>tables</span><span class=o>:</span> <span class=p>{</span> <span class=nx>permissionGroup</span><span class=o>:</span> <span class=p>{</span> <span class=nx>title</span> <span class=p>}</span> <span class=p>}</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>DM</span>
</pre></div> </td></tr></table> <p>But then the question arises: how can we use these names in our programs in such a way that we are protected agains typos?</p> </details> <details class=details><summary>Partial solution</summary><p>We tackle this problem in the server code, but not in the client code.</p> <details class=abstract><summary>Python</summary><p>Well, we convert the <code>.yaml</code> model files to Python modules that expose the same model, but now as Python data structure. This is done by means of the <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/server/config.py>config.py</a> script, just before starting the server. That enables us to collect the names and generate some code. Every part of the <code>.yaml</code> files that may act as a name, is collected. We then define a class <code>Names</code> that contains a member</p> <p><em>name</em> <code>= '</code><em>name</em><code>'</code></p> <p>for each <em>name</em>.</p> <p>So whenever we want to refer to a name in one of the models, we have a Python variable in our name space that is equal to that name prepended with <code>N.</code>. By consequently using <code>N.</code><em>name</em> instead of a plain string, we guard ourselves against typos, because the Python parser will complain about undefined variables.</p> </details> </details> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../../Legacy/Content/ title=Content class="md-flex md-footer-nav__link md-footer-nav__link--prev head-type" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> Content </span> </div> </a> <a href=../../Server/Authentication/ title=Authentication class="md-flex md-footer-nav__link md-footer-nav__link--next head-type" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> Authentication </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-disclaimer> The content of this site is produced under responsibility of project <b>Dans-labs/dariah-contrib</b> and is subject to change. </div> <div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> customised by <a href=https://github.com/Dans-labs>Dans-labs</a> </div> </div> <div class=md-footer-dans> <div>DANS is an institute of KNAW and NWO</div> <div> <a href=https://dans.knaw.nl/en title="Data Archiving and Networked Services (DANS)"><img class=md-footer-dans__img src=../../assets/images/DANS.gif height=50></a> <a target=_blank href=https://www.knaw.nl/en><img src=../../assets/images/knaw.png height=50></a> <a target=_blank href=https://www.nwo.nl/en><img src=../../assets/images/nwo.png height=50></a> </div> <div><i>Driven by data</i></div> </div> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <style>.md-footer-social__desc{font-family:"Open Sans",sans-serif;-webkit-font-smoothing:auto}</style> <ul class=md-footer-social> <li class=md-footer-social__li> <a href=http://eepurl.com/dvnr8D class="md-footer-social__link fa fa-envelope-square"> <span class=md-footer-social__desc>Newsletter</span> </a> </li> <li class=md-footer-social__li> <a href=https://twitter.com/DANSKNAW class="md-footer-social__link fa fa-twitter-square"> <span class=md-footer-social__desc>Twitter</span> </a> </li> <li class=md-footer-social__li> <a href=https://www.youtube.com/user/DANSDataArchiving class="md-footer-social__link fa fa-youtube-square"> <span class=md-footer-social__desc>YouTube</span> </a> </li> <li class=md-footer-social__li> <a href=https://www.linkedin.com/company/dans class="md-footer-social__link fa fa-linkedin-square"> <span class=md-footer-social__desc>LinkedIn</span> </a> </li> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.f780ca69.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script> </body> </html>