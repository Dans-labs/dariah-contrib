<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation of the DARIAH Contribution Tool.
"><meta name=author content="Dirk Roorda"><link href=https://dans-labs.github.io/dariah-contrib/Tech/Model/ rel=canonical><link rel=icon href=../../icons/favicon.ico><meta name=generator content="mkdocs-1.2.3, mkdocs-material-7.3.4"><title>Model - DARIAH contribution tool</title><link rel=stylesheet href=../../assets/stylesheets/main.db9e7362.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#model class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="DARIAH contribution tool" class="md-header__button md-logo" aria-label="DARIAH contribution tool" data-md-component=logo> <img src=../../images/inkind_logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DARIAH contribution tool </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Model </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/dans-labs/dariah-contrib/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> Dans-labs/dariah-contrib </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="DARIAH contribution tool" class="md-nav__button md-logo" aria-label="DARIAH contribution tool" data-md-component=logo> <img src=../../images/inkind_logo.png alt=logo> </a> DARIAH contribution tool </label> <div class=md-nav__source> <a href=https://github.com/dans-labs/dariah-contrib/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> Dans-labs/dariah-contrib </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> About <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=About data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../News/ class=md-nav__link> News </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> What does it do <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="What does it do" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> What does it do </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Workings/Business/ class=md-nav__link> Business </a> </li> <li class=md-nav__item> <a href=../../Workings/API/ class=md-nav__link> API </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> Import <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Import data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Import </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Workings/Bulk/ class=md-nav__link> Bulk </a> </li> <li class=md-nav__item> <a href=../../Workings/Content/ class=md-nav__link> Legacy </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Technical <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Technical data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Technical </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Model <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Model </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#mongodb class=md-nav__link> MongoDB </a> </li> <li class=md-nav__item> <a href=#data-model class=md-nav__link> Data model </a> </li> <li class=md-nav__item> <a href=#permission-model class=md-nav__link> Permission model </a> </li> <li class=md-nav__item> <a href=#name-handling class=md-nav__link> Name handling </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Workflow/ class=md-nav__link> Workflow </a> </li> <li class=md-nav__item> <a href=../Tables/ class=md-nav__link> Tables </a> </li> <li class=md-nav__item> <a href=../Web/ class=md-nav__link> Web </a> </li> <li class=md-nav__item> <a href=../Authentication/ class=md-nav__link> Authentication </a> </li> <li class=md-nav__item> <a href=../Inventory/ class=md-nav__link> Inventory </a> </li> <li class=md-nav__item> <a href=../Lessons/ class=md-nav__link> Lessons </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Maintenance <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Maintenance data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Maintenance </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Deploy/ class=md-nav__link> Deploy </a> </li> <li class=md-nav__item> <a href=../../api/html/control/ class=md-nav__link> Apidocs </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3> Testing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Testing data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Testing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../api/html/tests/conftest.html class=md-nav__link> Apidocs </a> </li> <li class=md-nav__item> <a href=../../api/html/tests/results.txt class=md-nav__link> Results </a> </li> <li class=md-nav__item> <a href=../../api/html/coverage/ class=md-nav__link> Coverage </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Codebase/ class=md-nav__link> Codebase </a> </li> <li class=md-nav__item> <a href=../Stats/ class=md-nav__link> Stats </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#mongodb class=md-nav__link> MongoDB </a> </li> <li class=md-nav__item> <a href=#data-model class=md-nav__link> Data model </a> </li> <li class=md-nav__item> <a href=#permission-model class=md-nav__link> Permission model </a> </li> <li class=md-nav__item> <a href=#name-handling class=md-nav__link> Name handling </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/dans-labs/dariah-contrib/edit/master/docs/Tech/Model.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=model>Model<a class=headerlink href=#model title="Permanent link">&para;</a></h1> <h2 id=mongodb>MongoDB<a class=headerlink href=#mongodb title="Permanent link">&para;</a></h2> <p>We store the data in a <a href=https://docs.mongodb.com>MongoDB</a> .</p> <details class=details><summary>Data as documents</summary><p>A MongoDB does not work with a fixed schema. A MongoDB <em>collection</em> consists of <em>documents</em>, which are essentially JSON-like structures, arbitrarily large and arbitrarily nested. That makes it easy to add new kinds of data to documents and collections when the need arises to do so. This will not break the existing code.</p> <p>MongoDB is optimized to read quickly, at the cost of more expensive data manipulation operations. Its documentation favours storing related data inside the main document. This increases the redundancy of the data and may lead to consistency problems, unless the application tries to enforce consistency somehow.</p> <p>In this app, with a limited amount of data, we use MongoDB primarily for its flexibility. We still adhere largely to SQL-like practices when we deal with related tables. So instead of storing the information of related documents directly inside the main document, we only store references to related documents inside the main documents.</p> </details> <details class=caution open=open><summary>Terminology</summary><p>Because our treatment of data is still very relational, we prefer wording derived from SQL databases, at least in the present documentation:</p> <table> <thead> <tr> <th>MongoDB</th> <th>SQL</th> </tr> </thead> <tbody> <tr> <td><em>collection</em></td> <td><strong>table</strong></td> </tr> <tr> <td><em>document</em></td> <td><strong>record</strong></td> </tr> </tbody> </table> </details> <h2 id=data-model>Data model<a class=headerlink href=#data-model title="Permanent link">&para;</a></h2> <p>This application uses configuration files in <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/server/yaml/tables.yaml>tables.yaml</a> and those in <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/server/tables>tables</a> to model tables and fields, with their permissions. It has base classes ( <a href=../../api/html/control/table.html>table</a>, <a href=../../api/html/control/record.html>record</a>, <a href=../../api/html/control/field.html>field</a>, <a href=../../api/html/control/details.html>details</a> ) to deal with most situations, but special tables may use their own derived classes.</p> <details class=abstract><summary>classification of tables</summary><details class=details><summary>user tables</summary><p>The main tables that receive user content: <em>contrib</em>, <em>assessment</em>, <em>review</em>.</p> </details> <details class=details><summary>user entry tables</summary><p>Tables that receive user content too, namely the entries users make in assessments and reviews: <em>criteriaEntry</em> and <em>reviewEntry</em>.</p> </details> <details class=details><summary>valueTables</summary><p>Tables that define the values for fields in other tables, such as <em>discipline</em>, <em>keyword</em>, <em>tadirahObject</em>. The <em>user</em> table is also a value table.</p> </details> <details class=details><summary>systemTables</summary><p>A subset of the value tables: <em>decision</em> and <em>permissionGroup</em>. Essential for the integrity of the business logic.</p> </details> </details> <details class=abstract><summary>details</summary><p>Details are records, usually in another table, having a field that points to their master record by means of an <code>_id</code> value.</p> <p>Which tables act as details for which masters is specified in <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/server/yaml/tables.yaml>tables.yaml</a>.</p> <details class=explanation><summary>master-detail</summary><p>A record may have <em>detail records</em> associated with it. We call such a record a <em>master record</em> with respect to its details.</p> </details> <details class=hint open=open><summary>Convention</summary><p>Whenever possible, the field in a detail table that points to a master is named after the master table.</p> </details> </details> <details class=details><summary>cascade</summary><p>When a master record is deleted, its details have a dangling reference to a non-existing master record. In some cases it is desirable to delete the detail records as well.</p> <details class=example><summary>criteriaEntry</summary><p><em>criteriaEntry</em> records are deleted with their master: an assessment record.</p> </details> <details class=example><summary>criteria</summary><p><em>criteria</em> records are <em>not</em> deleted with their master record.</p> </details> <details class=hint open=open><summary>Deletion prohibited</summary><p>In all cases where a record has dependencies, deletion of such a record is prohibited, unless all of its dependencies are marked for cascade-deletion.</p> <p>In order to remove a contribution with assessments and reviews, you first have to delete all its assessments and reviews.</p> </details> </details> <details class=abstract><summary>provenance</summary><p>Fields for recording the edit history of a record.</p> <details class=details open=open><summary>provenanceSpecs</summary><p>Field specifications for the provenance fields.</p> <p>We have these fields:</p> <details class=details><summary>editors</summary><p>List of ids of non-owner users that may edit this record, even if their group permissions do not allow it.</p> </details> <details class=details><summary>creator</summary><p>Id of the user that created the record.</p> </details> <details class=details><summary>dateCreated</summary><p>Datetime when the record was created.</p> </details> <details class=details><summary>modified</summary><p>Trail of modification events, each event has the name of the user who caused the change and the datetime when it happened. The trail will be weeded out over time.</p> </details> <p>The field "editors" may be changed by the owner of a record, and by people with higher powers such as the backoffice, not by the editors themselves (unless they also have higher power).</p> <p>All other fields cannot be modified by users, not even by users with higher powers. Only the system itself will write and update these fields.</p> <details class=caution><summary>Backdoors</summary><p>A person with access to the underlying Mongo DB can do with the data what (s)he wants.</p> <p>This requires a direct interaction with the machine on which the database resides. Webaccess is not sufficient.</p> </details> </details> </details> <p>The individual table models consist of the specifications of the fields in that table. For each field there is a key under which some specs are written.</p> <details class=details><summary>fieldSpecs</summary><details class=details><summary>label</summary><p>A user-friendly display name of the field.</p> </details> <details class=details><summary>type</summary><p>The data type of the field. It can be a plain data type, or the name of a value table that contains the possible values of this field.</p> <p>Possible plain types are:</p> <details class=details><summary>text</summary><p>A string of characters, usually just a one-liner. See <a href=../../api/html/control/typ/text.html#control.typ.text.Text>text</a>.</p> </details> <details class=details><summary>url</summary><p>A syntactically valid URL: i.e. a string of text that can be interpreted as a URL. A validation routine will check this. See <a href=../../api/html/control/typ/text.html#control.typ.text.Url>url</a>.</p> </details> <details class=details><summary>email</summary><p>A syntactically valid email address. A validation routine will check this. See <a href=../../api/html/control/typ/text.html#control.typ.text.Email>email</a>.</p> </details> <details class=details><summary>markdown</summary><p>A string of characters, which may extend to several pages, formatted as Markdown text. See <a href=../../api/html/control/typ/text.html#control.typ.text.Markdown>markdown</a>.</p> </details> <details class=details><summary>bool2</summary><p><code>true</code> or <code>false</code>. See <a href=../../api/html/control/typ/bool.html#control.typ.bool.Bool2>bool2</a>.</p> </details> <details class=details><summary>bool3</summary><p><code>true</code> , <code>null</code>, or <code>false</code>. See <a href=../../api/html/control/typ/bool.html#control.typ.bool.Bool3>bool3</a>.</p> </details> <details class=details><summary>int</summary><p>An integer number. See <a href=../../api/html/control/typ/numeric.html#control.typ.numeric.Int>int</a>.</p> </details> <details class=details><summary>decimal</summary><p>An decimal number. See <a href=../../api/html/control/typ/numeric.html#control.typ.numeric.Decimal>decimal</a>.</p> </details> <details class=details><summary>money</summary><p>An decimal number with an implicit monetary unit: €. See <a href=../../api/html/control/typ/numeric.html#control.typ.numeric.Money>money</a>.</p> </details> <details class=details><summary>datetime</summary><p>A date time, mostly represented in its <a href=https://en.wikipedia.org/wiki/ISO_8601>ISO 8601</a> format. See <a href=../../api/html/control/typ/datetime.html>datetime</a>.</p> </details> <details class=details><summary>Related values</summary><p>When a field refers to other records, there is much more to specify. In this case <code>type</code> is the name of a value table. See <a href=../../api/html/control/typ/related.html>related</a>.</p> </details> </details> <details class=details><summary>multiple</summary><p>Whether there is only one value allowed for this field, or a list of values.</p> </details> <details class=details><summary>perm</summary><p>Who has read and edit access to this field?</p> </details> <details class=hint open=open><summary>Conventions</summary><p>The specification is greatly simplified by conventions. Only what deviates from the following conventions needs to be specified:</p> <ul> <li><strong>label</strong>: same as table name, first letter capitalized</li> <li><strong>type</strong>: <code>text</code></li> <li><strong>multiple</strong>: <code>false</code></li> <li><strong>perm.read</strong>: <code>public</code></li> <li><strong>perm.edit</strong>: <code>edit</code>, i.e. the creator and the editors of the record.</li> <li>See below for more about permissions.</li> </ul> </details> </details> <h2 id=permission-model>Permission model<a class=headerlink href=#permission-model title="Permanent link">&para;</a></h2> <p>The authorization system is built on the basis of <em>groups</em> and <em>permission</em> levels.</p> <p><em>Users</em> are assigned to groups, and <em>things</em> require permission levels.</p> <p>When a user wants to act upon a thing, his/her group will be compared to the permission level of the thing, and based on the outcome of the comparison, the action will be allowed or forbidden.</p> <p>The configuration of the permissions system as a whole is in <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/server/yaml/perm.yaml>perm</a> .</p> <p>The the table-specific permissions are under the <code>perm</code> keys of the table config files mentioned above.</p> <details class=abstract><summary>Groups</summary><p>Under the key <code>roles</code> the groups and pseudo groups are given. Here is a short description.</p> <table> <thead> <tr> <th>group</th> <th>is pseudo</th> <th>description</th> </tr> </thead> <tbody> <tr> <td>nobody</td> <td>no</td> <td>deliberately empty: no user is member of this group</td> </tr> <tr> <td>public</td> <td>no</td> <td>user, not logged in</td> </tr> <tr> <td>auth</td> <td>no</td> <td>authenticated user</td> </tr> <tr> <td>edit</td> <td>yes</td> <td>authenticated user and editor of records in question</td> </tr> <tr> <td>own</td> <td>yes</td> <td>authenticated user and creator of records in question</td> </tr> <tr> <td>coord</td> <td>no</td> <td>national coordinator</td> </tr> <tr> <td>office</td> <td>no</td> <td>back office user</td> </tr> <tr> <td>system</td> <td>no</td> <td>system administrator</td> </tr> <tr> <td>root</td> <td>no</td> <td>full control</td> </tr> </tbody> </table> <details class=abstract><summary>Explanation</summary><p>Groups are attributes of users, as an indication of the power they have.</p> <p>Informally, we need to distinguish between:</p> <details class=details><summary>Nobody</summary><p><code>nobody</code> is a group without users, and if there were users, they could not do anything.</p> <p>Useful in cases where you want to state that something is not permitted to anybody.</p> </details> <details class=details><summary>The public</summary><p><code>public</code> is a group for unidentified an unauthenticated users.</p> <p>They can only list/read public information and have no right to edit anything and can do no actions that change anything in the database.</p> </details> <details class=details><summary>Authenticated users</summary><p><code>auth</code> is the group of DARIAH users authenticated by the DARIAH Identity provider.</p> <p>This is the default group for logged-in users.</p> <p>They can see DARIAH internal information (within limits) an can add items and then modify/delete them, within limits.</p> </details> <details class=details><summary>National coordinators</summary><p><code>coord</code> is the group of National Coordinators. They are DARIAH users that coordinate the DARIAH outputs for an entire member country.</p> <p>They can (de)select contributions and see their cost fields but only for contributions in the countries they coordinate.</p> </details> <details class=details><summary>Backoffice employees</summary><p><code>office</code> is the group of users that work for the DARIAH ERIC office.</p> <p>They can modify records created by others (within limits), but cannot perform technical actions that affect the system.</p> </details> <details class=details><summary>System managers</summary><p><code>sysadmin</code> is the group of users that control the system, not only through the interface of the app, but also with low-level access to the database and the machine that serves the app.</p> <p>Can modify system-technical records, within limits.</p> </details> <details class=details><summary>root</summary><p><code>root</code> is the one user that can bootstrap the system.</p> <p>Complete rights. Still there are untouchable things, that would compromise the integrity of the system. Even root cannot modify those from within the system.</p> <p>Root is the owner of the system, and can assign people to the roles of system managers and backoffice employees.</p> <p>From there on, these latter groups can do everything that is needed for the day-to-day operation of the functions that the system is designed to fulfill.</p> </details> <details class=caution><summary>Pseudo groups</summary><p>In some cases, the identity of the user is relevant, namely when users have a special relationship to the records they want to modify, such as <em>ownership</em>, <em>editorship</em>, etc. When those relationships apply, users are put in a pseudo group such <code>own</code> or <code>edit</code>.</p> </details> </details> </details> <details class=hint open=open><summary>Conventions</summary><p>For deletion of records we have a convention without exceptions:</p> <ul> <li>records in userEntry tables cannot be deleted directly, only as a result of deleting their master record.</li> <li>Users that have created a record or are mentioned in its <code>editors</code> field may also delete that record if no workflow conditions forbid it.</li> <li>Super users may delete records in user tables.</li> <li>Nobody may delete records in value tables.</li> </ul> </details> <details class=abstract><summary>Assigning users to groups</summary><p>Once users are in a group, their permissions are known. But there are also permissions to regulate who may assign groups to users.</p> <details class=caution open=open><summary>Not yet implemented</summary><p>These rules are not yet in force in the redesigned system</p> </details> <p>These permissions derive from the groups as well, with a few additional rules:</p> <ul> <li>nobody can assign anybody to the group <code>nobody</code>;</li> <li>a person can only add people to groups that have at most his/her own power;</li> <li>a person can only assign groups to people that have less power than him/herself.</li> </ul> </details> <details class=note><summary>Notes</summary><details class=example><summary>Example</summary><ul> <li>If you are <code>office</code>, you cannot promote yourself or anyone else to <code>system</code> or <code>root</code>.</li> <li>If you are <code>office</code>, you cannot demote another member of <code>office</code> to the group <code>auth</code>.</li> <li>You cannot demote/promote your peers, or the ones above you.</li> <li>You can demote yourself, but not promote yourself.</li> <li>You can demote people below you.</li> <li>You can promote people below you, but only up to your own level.</li> </ul> </details> <details class=note><summary><code>nobody</code></summary><p>Note that users in group <code>nobody</code> have no rights. There should be no users in that group, but if by misconfiguration there is a user in that group, (s)he can do nothing.</p> </details> <details class=caution><summary><code>root</code></summary><p>A consequence of the promotion/demotion rules is that if there is no user in the group <code>root</code>, nobody can be made <code>root</code> from within the system.</p> <p>Likewise, if a user is root, nobody can take away his/her root status, except him/herself.</p> <p>When importing data into the system by means of <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/scripts/load.sh>load.sh</a> you can specify to make a specific user <code>root</code>. Which user that is, is specified in <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/import/config.yaml>config.yaml</a> , see <code>rootUser</code>.</p> <p>The command is</p> <div class=highlight><pre><span></span><code>./load.sh -r
</code></pre></div> <p>to be executed in the home directory on the server.</p> <p>Alternatively, issuing</p> <div class=highlight><pre><span></span><code>./load.sh -R
</code></pre></div> <p>will also convert all <em>other</em> root users on the system to <em>office</em> users.</p> <p>Once the root user is in place, (s)he can assign system admins and back office people. Once those are in place, the daily governance of the system can take place.</p> </details> </details> <h2 id=name-handling>Name handling<a class=headerlink href=#name-handling title="Permanent link">&para;</a></h2> <details class=details><summary>The problem</summary><p>There are a lot of names in these yaml files. The most obvious way to use them in our programs (Python on the server, JavaScript on the client) is by just mentioning them as strings, e.g.:</p> <div class=highlight><pre><span></span><code><span class=n>title</span> <span class=o>=</span> <span class=n>DM</span><span class=p>[</span><span class=s1>&#39;tables&#39;</span><span class=p>][</span><span class=s1>&#39;permissionGroup&#39;</span><span class=p>][</span><span class=s1>&#39;title&#39;</span><span class=p>]</span>
</code></pre></div> <p>and</p> <div class=highlight><pre><span></span><code><span class=nx>title</span> <span class=o>=</span> <span class=nx>DM</span><span class=p>.</span><span class=nx>tables</span><span class=p>.</span><span class=nx>permissionGroup</span><span class=p>.</span><span class=nx>title</span>
</code></pre></div> <p>or</p> <div class=highlight><pre><span></span><code><span class=kd>const</span> <span class=p>{</span> <span class=nx>tables</span><span class=o>:</span> <span class=p>{</span> <span class=nx>permissionGroup</span><span class=o>:</span> <span class=p>{</span> <span class=nx>title</span> <span class=p>}</span> <span class=p>}</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>DM</span>
</code></pre></div> <p>But then the question arises: how can we use these names in our programs in such a way that we are protected agains typos?</p> </details> <details class=details><summary>Partial solution</summary><p>We tackle this problem in the server code, but not in the client code.</p> <details class=abstract><summary>Python</summary><p>Well, we convert the <code>.yaml</code> model files to Python modules that expose the same model, but now as Python data structure. This is done by means of the <a href=https://github.com/Dans-labs/dariah-contrib/blob/master/server/config.py>config.py</a> script, just before starting the server. That enables us to collect the names and generate some code. Every part of the <code>.yaml</code> files that may act as a name, is collected. We then define a class <code>Names</code> that contains a member</p> <p><em>name</em> <code>= '</code><em>name</em><code>'</code></p> <p>for each <em>name</em>.</p> <p>So whenever we want to refer to a name in one of the models, we have a Python variable in our name space that is equal to that name prepended with <code>N.</code>. By consequently using <code>N.</code><em>name</em> instead of a plain string, we guard ourselves against typos, because the Python parser will complain about undefined variables.</p> </details> </details> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../Workings/Content/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Legacy" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Legacy </div> </div> </a> <a href=../Workflow/ class="md-footer__link md-footer__link--next" aria-label="Next: Workflow" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Workflow </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.1e84347e.min.js></script> </body> </html>